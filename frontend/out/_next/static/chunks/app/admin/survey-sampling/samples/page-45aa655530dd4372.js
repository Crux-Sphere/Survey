(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8510],{48454:function(e,s,l){Promise.resolve().then(l.bind(l,31257))},31257:function(e,s,l){"use strict";l.d(s,{default:function(){return k}});var t=l(57437),r=l(2300),a=l(16463),n=l(2265),c=l(76965),i=l(69824),d=l(77902),o=l(84298),m=l(1633),u=l(85260),x=l(88726),p=function(e){let{open:s,onClose:l,refetch:a,surveyId:i}=e,[p,h]=(0,n.useState)([]),[f,b]=(0,n.useState)(!1),[g,j]=(0,n.useState)(""),[N,y]=(0,n.useState)(""),[v,w]=(0,n.useState)(""),[S,k]=(0,n.useState)(null),[_,Z]=(0,n.useState)("");(0,n.useEffect)(()=>{(async()=>{b(!0);try{let e=await (0,o.AW)({selectedRole:m.py});h(e.data)}catch(e){console.error("Error fetching users:",e),Z("Failed to load collectors")}finally{b(!1)}})()},[]);let P=null==p?void 0:p.map(e=>({value:e._id,label:e.name})),C=[{value:"random",label:"Random"},{value:"index",label:"Index"}],q=Array.from({length:Number(N)||0},(e,s)=>({value:s,label:"Index ".concat(s)})),E=()=>{j(""),y(""),w(""),k(null),Z("")},M=async e=>{if(e.preventDefault(),!g||!N||!v){Z("All fields are required.");return}if("index"===v&&null===S){Z("Please select an index.");return}try{await (0,r.Xg)({surveyId:i,userId:g,sampleSize:N,sampleMethod:v,index:"index"===v?S:null}),console.log("Data submitted successfully:"),x.ZP.success("Sample data saved successfully!"),E(),a(),l()}catch(e){console.error("Error submitting data:",e),x.ZP.error("Failed to save sample data.")}};return(0,t.jsx)(u.Z,{open:s,closeModal:()=>{E(),l()},children:(0,t.jsxs)("div",{className:"p-4 bg-white rounded-md shadow-md w-[500px]",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Add Sample"}),_&&(0,t.jsx)("div",{className:"text-red-500 mb-2",children:_}),f?(0,t.jsx)("div",{children:"Loading collectors..."}):(0,t.jsxs)("form",{onSubmit:M,className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-medium mb-1",children:"Select Collector"}),(0,t.jsx)(d.ZP,{value:P.find(e=>e.value===g),onChange:e=>j((null==e?void 0:e.value)||""),options:P,placeholder:"Select collector",classNamePrefix:"react-select",isSearchable:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-medium mb-1",children:"Sampling Size"}),(0,t.jsx)("input",{type:"number",value:N,onChange:e=>y(e.target.value),placeholder:"Enter sampling size",className:"w-full px-3 py-2 border rounded-md",min:1,required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-medium mb-1",children:"Sampling Method"}),(0,t.jsx)(d.ZP,{value:C.find(e=>e.value===v),onChange:e=>w((null==e?void 0:e.value)||""),options:C,placeholder:"Select sampling method",classNamePrefix:"react-select"})]}),"index"===v&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-medium mb-1",children:"Select Index"}),(0,t.jsx)(d.ZP,{value:q.find(e=>e.value===S),onChange:e=>k((null==e?void 0:e.value)||0),options:q,placeholder:"Select an index",classNamePrefix:"react-select",isDisabled:0===q.length})]}),(0,t.jsx)(c.Z,{type:"submit",className:"w-full",children:"Submit"})]})]})})},h=l(95650),f=l(22221),b=function(e){let{data:s,setSelectedResponse:l,setResponseModalIsOpen:r}=e,[a,c]=(0,n.useState)(null);return(0,t.jsx)("div",{id:"scrollableDiv",className:"w-[96%] mx-auto max-h-[80vh] overflow-auto vertical-scrollbar rounded-t-2xl border border-secondary-200",children:(0,t.jsxs)("table",{className:"w-full table-auto",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-dark-gray text-white sticky top-0 left-0 z-10",children:[(0,t.jsx)("td",{className:"min-w-32 px-4 py-2 border-b text-center whitespace-nowrap sticky left-0 bg-dark-gray",children:"Quality check status"}),(0,t.jsx)("td",{className:"px-4 py-2 border-b min-w-32 whitespace-nowrap text-center font-semibold",children:"Quality remark"}),(0,t.jsx)("td",{className:"px-4 py-2 border-b min-w-32 whitespace-nowrap text-center font-semibold",children:"Panna pramukh"}),(0,t.jsx)("td",{className:"px-4 py-2 border-b min-w-32 whitespace-nowrap text-center font-semibold",children:"Status"}),(0,t.jsx)("td",{className:"px-4 py-2 border-b min-w-32 whitespace-nowrap text-center font-semibold",children:"Remark"}),(0,t.jsx)("td",{className:"px-4 py-2 border-b min-w-32 whitespace-nowrap text-center font-semibold",children:"Response date"}),s&&s.length>0&&s[0].response_id.responses.map((e,s)=>(0,t.jsxs)("td",{className:"gap-2 font-semibold px-4 py-2 border-b min-w-32 whitespace-nowrap text-center",children:[a!==e.question_id?(0,h.aF)(e.question,10):e.question,(0,t.jsx)("button",{className:"text-primary-300 text-sm ml-2",onClick:s=>{s.stopPropagation(),c(a===e.question_id?null:e.question_id)},children:a!==e.question_id&&e.question.length>10?"More":"Less"})]},s))]})}),(0,t.jsx)("tbody",{className:"bg-white",children:s&&s.map((e,s)=>{let{response_id:a}=e;return(0,t.jsxs)("tr",{onClick:()=>{l(a),r(!0)},className:"cursor-pointer",children:[(0,t.jsx)("td",{className:"min-w-32 px-4 py-4 border-b h-full sticky left-0 bg-white w-full text-center",children:(0,t.jsx)("p",{className:"font-bold ".concat("Pending"===a.status?"text-amber-400":"Approved"===a.status?"text-green-600":"text-red-500"),children:a.status})}),(0,t.jsx)("td",{className:"min-w-32 px-4 py-4 border-b text-center",children:a.quality_check_remarks&&a.quality_check_remarks.length>0?a.quality_check_remarks[a.quality_check_remarks.length-1].note:"--"}),(0,t.jsx)("td",{className:"min-w-32 px-4 py-4 border-b text-center",children:a.panna_pramukh_assigned?a.panna_pramukh_assigned.name:"--"}),(0,t.jsx)("td",{className:"min-w-32 px-4 py-4 border-b text-center",children:a.contacted?(0,t.jsx)("p",{className:"w-full p-2 bg-green-200 rounded-md",children:"Complete"}):a.panna_pramukh_assigned?(0,t.jsx)("p",{className:"w-full p-2 bg-amber-300 rounded-md",children:"Pending"}):"---"}),(0,t.jsx)("td",{className:"min-w-32 px-4 py-4 border-b text-center",children:a.remark?(0,h.aF)(a.remark,15):"---"}),(0,t.jsx)("td",{className:"min-w-32 px-4 py-4 border-b text-center",children:(0,h.p6)(a.createdAt)}),a.responses.map((e,s)=>(0,t.jsx)(f.Z,{expand:!1,questionType:e.question_type,response:e.response}))]},s)})})]})})},g=l(80106),j=function(e){let{selectedResponse:s,setResponseModalIsOpen:l,responseModalIsOpen:r}=e,[a,c]=(0,n.useState)(!1),i=(null==s?void 0:s.remark_list)&&s.remark_list.length>0?a?[...s.remark_list].reverse():[...s.remark_list].reverse().slice(0,2):[];return(0,t.jsx)(u.Z,{open:r,closeModal:()=>l(!1),children:s&&(0,t.jsx)("div",{className:"p-4 h-[80vh] flex justify-center items-center w-[60vw]",children:(0,t.jsxs)("div",{className:"flex h-full w-full justify-center items-center flex-col gap-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 w-full",children:[(0,t.jsx)("h2",{className:"w-full h-full text-center text-xl font-semibold border-b-2 pb-2",children:"Question"}),(0,t.jsx)("p",{className:"w-full h-full text-center text-xl font-semibold border-b-2 pb-2",children:"Response"})]}),(0,t.jsxs)("div",{className:"flex h-full w-full flex-col overflow-y-auto vertical-scrollbar",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 w-full",children:[(0,t.jsx)("p",{className:"py-4 bg-primary-50 w-full h-full text-center font-medium",children:"Status"}),(0,t.jsx)("p",{className:"py-4 bg-primary-50 w-full h-full flex justify-center font-medium",children:s.contacted?(0,t.jsx)("p",{className:"bg-green-200 p-2 rounded-md w-fit",children:"Completed"}):(0,t.jsx)("p",{children:"Pending"})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 w-full",children:[(0,t.jsx)("p",{className:"py-4 bg-primary-100 w-full h-full text-center font-medium",children:"Remark"}),(0,t.jsx)("div",{className:"grid grid-cols-2 py-4 bg-primary-100 w-full text-center h-full font-medium",children:s.remark_list&&s.remark_list.length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{className:"font-semibold",children:["Report:"," "]}),(0,t.jsx)("p",{className:"font-normal ml-2",children:s.remark_list[s.remark_list.length-1].remark}),(0,t.jsxs)("p",{className:"font-semibold",children:["Date:"," "]}),(0,t.jsx)("p",{className:"font-normal ml-2",children:(0,h.p6)(s.remark_list[s.remark_list.length-1].date)}),(0,t.jsxs)("p",{className:"font-semibold",children:["Time:"," "]}),(0,t.jsx)("p",{className:"font-normal ml-2",children:(0,h.mr)(s.remark_list[s.remark_list.length-1].date)})]}):"---"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 w-full bg-primary-50",children:[(0,t.jsx)("h2",{className:"font-medium py-4 text-center",children:"Remark History"}),s.remark_list&&s.remark_list.length>0?(0,t.jsxs)("div",{className:"p-4 flex flex-col items-center ",children:[i.map((e,s)=>(0,t.jsxs)("div",{className:"grid grid-cols-2 w-full py-2 border-b last:border-b-0",children:[(0,t.jsx)("p",{className:"font-medium text-primary-700",children:e.remark}),(0,t.jsx)("p",{className:"text-xs text-gray-600 text-end",children:"".concat((0,h.p6)(e.date)," at ").concat((0,h.mr)(e.date))})]},s)),s.remark_list.length>2&&(0,t.jsx)("button",{onClick:()=>{c(e=>!e)},className:"mt-4 text-sm font-medium hover:text-gray-500",children:a?"Show Less":"Show More"})]}):(0,t.jsx)("p",{className:"text-center",children:"No remarks available."})]}),s.responses.map((e,s)=>(0,t.jsxs)("div",{className:"grid grid-cols-2 w-full",children:[(0,t.jsx)("h2",{className:"w-full py-4 h-full text-center ".concat(s%2==0?"bg-primary-50":"bg-primary-100"),children:e.question}),(0,t.jsx)("p",{className:"w-full py-4 h-full flex justify-center items-center ".concat(s%2==0?"bg-primary-50":"bg-primary-100"),children:(0,t.jsx)(f.Z,{questionType:e.question_type,response:e.response,expand:!0})})]},s))]})]})})})},N=l(4815),y=function(e){let{open:s,closeModal:l,surveyId:a,setSelectedCollector:i,setSelectedGroup:p,selectedCollector:h,selectedGroup:f,refetch:b}=e,[g,j]=(0,n.useState)([]),[y,v]=(0,n.useState)([]),[w,S]=(0,n.useState)(!0);async function k(){try{let e=await (0,o.AW)({selectedRole:m.py});e.success?v(e.data.map(e=>({value:e._id,label:e.name}))):x.ZP.error("Error fetching collectors")}catch(e){console.error("Error fetching collectors:",e),x.ZP.error("Error fetching collectors")}}async function _(e){S(!0);try{let s=await (0,r.MV)({survey_id:a,user_id:e});s.success?j(s.data.map(e=>({value:e.group_id,label:"".concat(e.group_id," --> ").concat(e.survey_collector)}))):x.ZP.error("Error fetching groups")}catch(e){console.error("Error fetching groups:",e),x.ZP.error("Error fetching groups")}S(!1)}return(0,n.useEffect)(()=>{k()},[]),(0,n.useEffect)(()=>{s&&_()},[s]),(0,t.jsx)(u.Z,{open:s,closeModal:l,children:(0,t.jsxs)("div",{className:"relative w-[40vw]  p-4",children:[w&&(0,t.jsxs)("div",{className:"absolute inset-0 z-30 bg-black/65 flex flex-col justify-center items-center gap-10 h-full w-full",children:[(0,t.jsx)(N.Z,{speedMultiplier:1.25,color:"#FF8437"}),(0,t.jsx)("h3",{className:"text-white font-semibold",children:"Loading groups..."})]}),(0,t.jsxs)("div",{className:" w-full flex items-center flex-col space-y-6 border-2 rounded-md h-full p-3 bg-lighter-gray",children:[(0,t.jsx)("h1",{className:"text-primary-300 font-semibold text-xl",children:"Filter samples"}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 w-full",children:[(0,t.jsx)("h1",{children:"Choose survey collector"}),(0,t.jsx)(d.ZP,{value:h,options:y,placeholder:"Select a collector",className:"w-full",onChange:e=>{i(e),p(null),_(null==e?void 0:e.value)},isSearchable:!0})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 w-full",children:[(0,t.jsx)("h1",{children:"Choose group"}),(0,t.jsx)(d.ZP,{value:f,options:g,placeholder:"Select a group",className:"w-full",onChange:e=>{p(e)},isSearchable:!0,isDisabled:w||!h})]}),(0,t.jsx)(c.Z,{onClick:function(){b(),l()},children:"Filter"})]})]})})},v=l(83389),w=l(16356),S=function(e){let{open:s,closeModal:l,refetch:a,surveyId:i,currentGroupId:d,setSelectedGroup:o}=e,[m,p]=(0,n.useState)(!1);async function h(){p(!0),(await (0,r.e6)({surveyId:i,groupId:d,mode:"group"})).success?(x.ZP.success("Sampling group successfully deleted!"),o(null),a()):x.ZP.error("Failed to delete sampling group"),p(!1),l()}return(0,t.jsx)(u.Z,{preventOutsideClose:m,open:s,closeModal:l,children:(0,t.jsxs)("div",{className:"relative flex flex-col h-[40vh] w-[40vw] justify-center items-center gap-10 ",children:[m&&(0,t.jsxs)("div",{className:"absolute inset-0 z-30 bg-black/65 flex flex-col justify-center items-center gap-10 h-full w-full",children:[(0,t.jsx)(N.Z,{speedMultiplier:1.25,color:"#FF8437"}),(0,t.jsx)("h3",{className:"text-white font-semibold",children:"Deleting survey..."})]}),(0,t.jsx)("h1",{className:"text-xl",children:"Are you sure you want to delete this group?"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(c.Z,{onClick:h,className:"w-40",children:"Yes"}),(0,t.jsx)(c.Z,{className:"w-40",onClick:l,children:"No"})]})]})})},k=function(){let[e,s]=(0,n.useState)(null),[l,d]=(0,n.useState)(!0),[o,m]=(0,n.useState)(!1),[u,h]=(0,n.useState)(!1),[f,N]=(0,n.useState)(!1),[k,_]=(0,n.useState)(null),[Z,P]=(0,n.useState)(null),[C,q]=(0,n.useState)(!1),[E,M]=(0,n.useState)(null),[R,F]=(0,n.useState)(null),[I,A]=(0,n.useState)(""),[D,z]=(0,n.useState)(1),[L,O]=(0,n.useState)(10),[G,W]=(0,n.useState)(0),[Q,T]=(0,n.useState)(!1),H=(0,a.useSearchParams)().get("survey_id");async function K(){d(!0);let e=await (0,r.WK)({surveyId:H,groupId:null==R?void 0:R.value,userId:null==E?void 0:E.value,page:D,limit:L||10});e.success?(s(e.data),P(e.group_details),A(e.group_id),W(e.pagination.totalPages),z(e.pagination.currentPage),O(e.pagination.limit)):x.ZP.error("Error fetching samples"),d(!1)}if((0,n.useEffect)(()=>{K()},[o,D,L]),l)return(0,t.jsx)(g.Z,{});let V=e&&e.length>0;return(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold",children:"Survey Sampling"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[V&&(0,t.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,t.jsxs)(c.Z,{onClick:()=>{T(!0)},className:"bg-red-400 hover:bg-red-500 gap-3",children:[(0,t.jsx)(w.ZkW,{})," Delete"]}),(0,t.jsx)(c.Z,{onClick:()=>q(!0),children:"Filter"})]}),(0,t.jsxs)(c.Z,{onClick:()=>h(!0),className:"flex gap-3 items-center",children:[(0,t.jsx)(i.S$f,{className:"text-2xl"})," Add Sampling"]})]})]}),V&&(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,t.jsx)("h1",{className:"text-xl font-semibold",children:"Group Details - "}),(0,t.jsx)("p",{className:"font-semibold text-primary-300",children:I})]}),Z?(0,t.jsx)("div",{className:"mt-2 border border-gray-200 rounded-lg p-4",children:(0,t.jsxs)("table",{className:"w-full text-left border-collapse",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-100",children:[(0,t.jsx)("th",{className:"border px-4 py-2",children:"Sampling Method"}),(0,t.jsx)("th",{className:"border px-4 py-2",children:"Sample Size"}),(0,t.jsx)("th",{className:"border px-4 py-2",children:"Collector"})]})}),(0,t.jsx)("tbody",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"border px-4 py-2",children:Z.sampling_method}),(0,t.jsx)("td",{className:"border px-4 py-2",children:Z.sample_size}),(0,t.jsx)("td",{className:"border px-4 py-2",children:Z.collector_name})]})})]})}):(0,t.jsx)("p",{className:"text-gray-500",children:"No group details available."})]}),V?(0,t.jsx)("div",{className:"h-screen",children:(0,t.jsx)(b,{setResponseModalIsOpen:N,setSelectedResponse:_,data:e})}):(0,t.jsxs)("div",{className:"w-full h-[calc(100vh-156px)] flex justify-center items-center font-semibold text-secondary-300 flex-col gap-5",children:[(0,t.jsx)("img",{src:"/icons/no-data.png",className:"object-contain h-20"}),(0,t.jsx)("p",{children:"No samplings yet for this survey"})]}),V&&(0,t.jsx)(v.Z,{page:D,pageLimit:L,setPage:z,setPageLimit:O,totalResponsePages:G}),(0,t.jsx)(p,{surveyId:H,open:u,onClose:()=>h(!1),refetch:()=>m(!o)}),(0,t.jsx)(j,{responseModalIsOpen:f,selectedResponse:k,setResponseModalIsOpen:N}),(0,t.jsx)(y,{open:C,setSelectedCollector:M,setSelectedGroup:F,selectedCollector:E,selectedGroup:R,closeModal:()=>q(!1),refetch:()=>m(!o),surveyId:H}),(0,t.jsx)(S,{closeModal:()=>T(!1),currentGroupId:I,open:Q,surveyId:H||"",refetch:()=>m(!o),setSelectedGroup:F})]})}}},function(e){e.O(0,[5452,6051,8472,8726,9413,1181,8143,1071,9693,8780,1668,2971,7023,1744],function(){return e(e.s=48454)}),_N_E=e.O()}]);