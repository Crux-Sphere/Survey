(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8182],{55451:function(e,s,t){Promise.resolve().then(t.bind(t,66609))},66609:function(e,s,t){"use strict";t.r(s);var a=t(57437),l=t(76965),n=t(81382),r=t(40855),i=t(2265),o=t(60152),c=t(16463),d=t(84298),u=t(94962),p=t(80106),x=t(77744),m=t(60274),h=t(78731),f=t(55691),b=t(95673),g=t(50336),j=t(82744),w=t(64785),y=t(66648),N=t(554),v=t(69824),S=t(1633);function k(){let[e,s]=(0,i.useState)(null),[t,k]=(0,i.useState)(null),[_,Z]=(0,i.useState)([]),[D,C]=(0,i.useState)(!1),[P,M]=(0,i.useState)(!1),[q,R]=(0,i.useState)(""),[A,O]=(0,i.useState)([]),[F,E]=(0,i.useState)(""),[I,L]=(0,i.useState)(""),[U,B]=(0,i.useState)(""),[Q,T]=(0,i.useState)(""),[z,G]=(0,i.useState)([]),[J,K]=(0,i.useState)([]),[W,Y]=(0,i.useState)(!0),[H,V]=(0,i.useState)(!1),[X,$]=(0,i.useState)(null),[ee,es]=(0,i.useState)(null),[et,ea]=(0,i.useState)(!1),[el,en]=(0,i.useState)(null),[er,ei]=(0,i.useState)(!1),[eo,ec]=(0,i.useState)(!1),[ed,eu]=(0,i.useState)(null),[ep,ex]=(0,i.useState)(null),[em,eh]=(0,i.useState)(null),[ef,eb]=(0,i.useState)(null),[eg,ej]=(0,i.useState)(1),[ew,ey]=(0,i.useState)(10),[eN,ev]=(0,i.useState)(1),[eS,ek]=(0,i.useState)(!1),[e_,eZ]=(0,i.useState)([]),eD=(0,c.useSearchParams)(),eC=eD.get("survey_id"),eP=eD.get("collector_id"),eM=(0,c.useRouter)(),{isLoaded:eq}=(0,x.Ji)({id:"google-map-script",googleMapsApiKey:"AIzaSyAAOwDBvpg5ZDv5JFG-CoDW23GsKkOPeuA"});async function eR(){let s,a;e&&t&&(s=new Date(e||""),a=new Date(t||""),s.setDate(s.getDate()+1),a.setDate(a.getDate()+1));let l={surveyId:eC,startDate:s,endDate:a,userId:eP,filters:z,limit:ew,page:eN};console.log("params are -->",l),V(!0);let n=await (0,o.K7)(l);K(n.data),ej(n.totalPages),console.log("responses of responses ------>",n),n.data&&n.data.length>0&&en(n.data[0].responses.map(e=>({question:e.question,question_id:e.question_id}))),V(!1)}async function eA(){let e=await (0,m.LA)({_id:eC});console.log("current survey-->",e),e.success?(console.log("setting ac_list",e.data.ac_list),eZ(e.data.ac_list),eb(e.data.questions.map(e=>e))):u.ZP.error("Error fetching the survey!")}async function eO(){V(!0);let e=await (0,d.AW)({selectedRole:S.py});console.log("users-------->",e.data),Z(e.data),V(!1)}async function eF(){V(!0),console.log("ac list is coming  --->",e_);let e=await (0,d.Yx)({ac_list:e_,filter:ed});console.log("panna below-------->",e),ex(e),V(!1)}(0,i.useEffect)(()=>{eA(),eR(),eO()},[W,eN,ew]),(0,i.useEffect)(()=>{e_.length>0&&eF()},[ed,e_]);let eE=()=>{C(!1),eI()},eI=()=>{E(""),L(""),B("")},eL=async()=>{try{let s,a;ek(!0),e&&t&&(s=new Date(e||""),a=new Date(t||""),s.setDate(s.getDate()+1),a.setDate(a.getDate()+1));let l={surveyId:eC,startDate:s,endDate:a,userId:eP,filters:z,download:!0},n="response.xlsx",r=await (0,o.kz)(l),i=r.headers["content-disposition"];console.log("header ======>",i);let c=i.split("filename=")[1].replace(/"/g,"");c&&(n=c);let d=window.URL.createObjectURL(new Blob([r.data])),u=document.createElement("a");u.href=d,u.setAttribute("download",n),document.body.appendChild(u),u.click(),document.body.removeChild(u)}catch(e){u.ZP.error("Failed to export to Excel")}finally{ek(!1)}};return null==_||_.map(e=>({value:e._id,label:e.name})),(0,a.jsxs)("div",{className:"flex flex-col min-h-[calc(100vh-80px)] w-full font-medium bg-light-gray",children:[(0,a.jsxs)("nav",{className:"w-full py-3 px-8 flex flex-col gap-10 font-semibold",children:[(0,a.jsx)("h3",{className:"text-[24px] font-semibold",children:"Survey Response"}),(0,a.jsxs)("div",{className:"flex w-full gap-12",children:[(0,a.jsx)(h.Z,{appliedFilters:z,filters:A,responses:J,selectedFilter:Q,setAppliedFilters:G,setSelectedFilter:T,surveyQuestions:ef}),(0,a.jsxs)("div",{className:"flex space-x-2 text-black text-base font-semibold",children:[(0,a.jsx)(l.Z,{loading:eS,onClick:eL,className:"rounded-[20px] h-fit px-4 py-2 w-44 justify-center",children:"Export to Excel"}),(0,a.jsx)(n.Z,{onClick:()=>eM.back(),className:"rounded-[20px] h-fit px-4 py-2",children:"Back"})]})]})]}),(0,a.jsx)("div",{className:"p-5 font-semibold text-sm ",children:(0,a.jsx)("div",{className:"bg-light-gray space-y-4 w-full rounded-lg px-4 py-6",children:(0,a.jsxs)("div",{className:"w-[780px] space-y-8 pb-6 ",children:[(0,a.jsxs)("div",{className:"flex gap-10",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex gap-3 items-center mb-5",children:[(0,a.jsx)("h1",{className:"",children:"Date Range"}),(0,a.jsx)(y.default,{src:N.Z.src,alt:"calender",height:18,width:18})]}),(0,a.jsx)("div",{className:"w-fit",children:(0,a.jsx)(r.Z,{className:"w-[352px] h-10",startDate:e,endDate:t,setStartDate:s,setEndDate:k})})]}),(0,a.jsx)(l.Z,{className:" flex justify-center items-center h-fit self-end",onClick:()=>{C(!0)},children:"Data filter +"})]}),(0,a.jsx)("div",{className:"flex gap-5 items-center",children:(0,a.jsxs)("div",{className:"flex space-x-4",children:[(0,a.jsx)(n.Z,{onClick:()=>{s(null),k(null),G([]),Y(!W)},className:"bg-dark-gray text-white",children:"Reset"}),(0,a.jsx)(l.Z,{disabled:0===z.length&&!e&&!t,onClick:()=>{if(e&&!t||t&&!e){u.ZP.error("Please select a complete date range!");return}eR()},className:"disabled:cursor-not-allowed disabled:bg-primary-100 disabled:text-secondary-100",children:"Apply"})]})})]})})}),H&&(0,a.jsx)(p.Z,{className:"h-[30vh] w-full flex justify-center items-center"}),!H&&J&&J.length>0?(0,a.jsx)(w.Z,{selectedPanna:em,more:X,responses:J,setMapModalIsOpen:ea,setMore:$,setResponseModalIsOpen:M,setSelectedResponse:es,users:_,assignMode:er,setAssignedMode:ei,getUserResponses:eR,setSelectedPanna:eh}):!H&&(0,a.jsx)("div",{className:"flex w-full justify-center items-center h-[30vh]",children:(0,a.jsx)("p",{children:"No responses from collector"})}),!H&&(0,a.jsxs)("div",{className:"flex gap-3 items-center my-4 ml-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"limit-select",className:"mr-2",children:"Show:"}),(0,a.jsxs)("select",{id:"limit-select",value:ew,onChange:e=>{ey(parseInt(e.target.value,10))},className:"p-2 border rounded-md",children:[(0,a.jsx)("option",{value:10,children:"10"}),(0,a.jsx)("option",{value:20,children:"20"}),(0,a.jsx)("option",{value:50,children:"50"}),(0,a.jsx)("option",{value:100,children:"100"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("button",{onClick:()=>{ev(eN-1)},disabled:1===eN,className:"p-2 border rounded-md disabled:opacity-50",children:(0,a.jsx)(v.u1R,{})}),(0,a.jsxs)("span",{children:["Page ",eN," of ",eg]}),(0,a.jsx)("button",{onClick:()=>{ev(eN+1)},disabled:eN===eg,className:"p-2 border rounded-md disabled:opacity-50",children:(0,a.jsx)(v.hjJ,{})})]})]}),(0,a.jsx)(f.Z,{modalIsOpen:D,closeModal:eE,surveyQuestions:ef,question:F,questionType:q,operator:I,response:U,setQuestionType:R,setQuestion:E,setOperator:L,setResponse:B,saveFilter:()=>{O([...A,{question:F,operator:I,response:U}]),eE()}}),(0,a.jsx)(b.Z,{responseModalIsOpen:P,selectedResponse:ee,setResponseModalIsOpen:M,users:_}),(0,a.jsx)(j.Z,{isLoaded:eq,mapModalIsOpen:et,setMapModalIsOpen:ea}),(0,a.jsx)(g.Z,{assignMode:er,pannaPramukh:ep,selectedPanna:em,setAssignMode:ei,setSelectedPanna:eh,setUserModal:ec,setUserSearch:eu,userModal:eo,userSearch:ed||""})]})}s.default=()=>(0,a.jsx)(i.Suspense,{children:(0,a.jsx)(k,{})})},82744:function(e,s,t){"use strict";var a=t(57437),l=t(77744);t(2265);var n=t(85260);s.Z=function(e){let{mapModalIsOpen:s,isLoaded:t,setMapModalIsOpen:r}=e;return(0,a.jsx)(n.Z,{open:s,closeModal:()=>r(!1),children:(0,a.jsx)("div",{className:"p-4 h-[60vh] flex justify-center items-center w-[50vw]",children:(0,a.jsx)("div",{className:"flex h-full w-full justify-center items-center flex-col gap-4",children:t?(0,a.jsx)(l.b6,{mapContainerStyle:{width:"400px",height:"400px"},center:{lat:-3.745,lng:-38.523},zoom:10,onLoad:e=>{console.log("gmap--->",e);let s=new window.google.maps.LatLngBounds;e.fitBounds(s)},onUnmount:e=>{},children:(0,a.jsx)(a.Fragment,{})}):(0,a.jsx)(a.Fragment,{})})})})}},64785:function(e,s,t){"use strict";var a=t(57437),l=t(95650),n=t(2265),r=t(41942),i=t(63872),o=t(76965),c=t(94962),d=t(84298),u=t(16463),p=t(22221);s.Z=function(e){let{responses:s,users:t,assignMode:x,setSelectedResponse:m,setResponseModalIsOpen:h,setMapModalIsOpen:f,setMore:b,more:g,setAssignedMode:j,selectedPanna:w,getUserResponses:y,setSelectedPanna:N}=e;console.log("all responses /////////////// ",s);let[v,S]=(0,n.useState)(null),[k,_]=(0,n.useState)(null),[Z,D]=(0,n.useState)([]),C=(0,u.useSearchParams)().get("survey_id");async function P(){let e=await (0,d.qq)({id:w,responses:Z,surveyId:C});console.log("after updation ----->",e),e.success?(c.ZP.success("Data assigned successfully"),j(!1),D([]),N(null),y()):(console.log("error response --->",e),c.ZP.error(e.message))}return console.log("selectedResponses are from outside --->",Z),(0,a.jsxs)("div",{id:"scrollableDiv",className:"w-[96%] mx-auto max-h-[80vh] overflow-auto vertical-scrollbar rounded-t-2xl border border-secondary-200",children:[(0,a.jsxs)("table",{className:"w-full table-auto",children:[(0,a.jsx)("thead",{className:"",children:(0,a.jsxs)("tr",{className:"bg-dark-gray text-white sticky top-0",children:[(0,a.jsx)("td",{className:"min-w-32 px-4 py-2 border-b text-center"}),(0,a.jsx)("td",{className:"min-w-32 px-4 py-2 border-b text-center"}),x&&(0,a.jsx)("td",{className:"min-w-32 px-4 py-2 border-b text-center"}),(0,a.jsx)("td",{className:"px-4 py-2 border-b min-w-32 whitespace-nowrap text-center font-semibold",children:"Panna pramukh"}),(0,a.jsx)("td",{className:"px-4 py-2 border-b min-w-32 whitespace-nowrap text-center font-semibold",children:"Status"}),(0,a.jsx)("td",{className:"px-4 py-2 border-b min-w-32 whitespace-nowrap text-center font-semibold",children:"Remark"}),(0,a.jsx)("td",{className:"px-4 py-2 border-b min-w-32 whitespace-nowrap text-center font-semibold",children:"Response date"}),(0,a.jsx)("td",{className:"px-4 py-2 border-b min-w-32 whitespace-nowrap text-center font-semibold",children:"User"}),s&&s.length>0&&s[0].responses.map((e,s)=>(0,a.jsxs)("td",{className:"gap-2 font-semibold px-4 py-2 border-b min-w-32 whitespace-nowrap text-center",children:[g!==e.question_id?(0,l.aF)(e.question,10):e.question,(0,a.jsx)("button",{className:"text-primary-300 text-sm ml-2",onClick:()=>b(e.question_id),children:g!==e.question_id&&e.question.length>10?"More":""}),(0,a.jsx)("button",{className:"text-primary-300 text-sm ml-2",onClick:()=>b(null),children:g===e.question_id&&e.question.length>10?"Less":""})]},s))]})}),(0,a.jsx)("tbody",{className:"bg-white",children:s&&s.map((e,n)=>{var d;return(0,a.jsxs)("tr",{onClick:()=>{m(e),h(!0)},className:"cursor-pointer",children:[x&&(0,a.jsx)("td",{onClick:e=>e.stopPropagation(),className:"min-w-32 px-4 py-2 border-b text-center",children:(0,a.jsx)("input",{disabled:e.panna_pramukh_assigned,onChange:()=>(function(e,t){if(null===v)S(t),D([e]);else{if(t===v){S(null),_(null),D([]);return}if(t<v){S(t),_(null),D([e]);return}if(t>v){if(_(t),Math.abs(t-v)+1>60){c.ZP.error("Maximum of 60 responses are allowed");return}console.log("all responses are ------>",s);let e=[];for(let a=v;a<=t;a++)s[a].panna_pramukh_assigned||e.push(s[a]._id);D(e)}if(null!==k&&t<k){_(t);let e=[];for(let a=v;a<=t;a++)e.push(s[a]._id);D(e)}}})(e._id,n),checked:Z.includes(e._id),className:"h-5 w-5",type:"checkbox"})}),(0,a.jsx)("td",{className:"min-w-32 px-4 py-2 border-b text-center",children:(0,a.jsx)(o.Z,{className:"w-10 p-0 flex justify-center items-center rounded-full h-10",onClick:e=>{e.stopPropagation(),f(!0)},children:(0,a.jsx)(i.GUT,{})})}),(0,a.jsx)("td",{className:"min-w-32 px-4 py-2 border-b text-center",children:(0,a.jsx)(r.dSq,{})}),(0,a.jsx)("td",{className:"min-w-32 px-4 py-2 border-b text-center",children:e.panna_pramukh_assigned?e.panna_pramukh_assigned.name:"--"}),(0,a.jsx)("td",{className:"min-w-32 px-4 py-2 border-b text-center",children:e.contacted?(0,a.jsx)("p",{className:"w-full p-2 bg-green-200 rounded-md",children:"Complete"}):e.panna_pramukh_assigned?(0,a.jsx)("p",{className:"w-full p-2 bg-amber-300 rounded-md",children:"Pending"}):"---"}),(0,a.jsx)("td",{className:"min-w-32 px-4 py-2 border-b text-center",children:e.remark?(0,l.aF)(e.remark,15):"---"}),(0,a.jsx)("td",{className:"min-w-32 px-4 py-2 border-b text-center",children:(0,l.p6)(e.createdAt)}),(0,a.jsx)("td",{className:"min-w-44 whitespace-nowrap px-4 py-2 border-b text-center",children:(null===(d=t.find(s=>s._id===e.user_id))||void 0===d?void 0:d.name)||"-"}),e.responses.map((e,s)=>(0,a.jsx)(p.Z,{expand:!1,questionType:e.question_type,response:e.response}))]},n)})})]}),x&&(0,a.jsxs)("div",{className:"flex gap-2 mt-5 ml-3 sticky bottom-0 bg-white left-3",children:[(0,a.jsx)(o.Z,{onClick:()=>{P()},children:"Assign"}),(0,a.jsx)(o.Z,{onClick:()=>{j(!1),D([]),S(null),_(null)},children:"Cancel"})]})]})}}},function(e){e.O(0,[5223,5452,7699,4574,1544,7240,1910,8472,4962,9413,1181,4049,8143,2527,1805,663,2971,7023,1744],function(){return e(e.s=55451)}),_N_E=e.O()}]);