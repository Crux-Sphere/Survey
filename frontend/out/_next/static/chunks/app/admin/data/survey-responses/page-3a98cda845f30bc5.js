(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8830],{66320:function(e,s,a){Promise.resolve().then(a.bind(a,8877))},8877:function(e,s,a){"use strict";a.r(s);var t=a(57437),l=a(76965),n=a(81382),c=a(40855),o=a(2265),i=a(60152),r=a(16463),d=a(84298),u=a(88726),p=a(80106),x=a(77744),h=a(77902),m=a(60274),f=a(78731),v=a(55691),g=a(95673),j=a(50336),b=a(82744),S=a(64785),y=a(66648),N=a(554),w=a(69824),Z=a(1633),C=a(56806);function _(){let[e,s]=(0,o.useState)(null),[a,_]=(0,o.useState)(null),[P,A]=(0,o.useState)([]),[D,k]=(0,o.useState)(!1),[M,R]=(0,o.useState)(!1),[E,F]=(0,o.useState)(""),[O,B]=(0,o.useState)([]),[I,q]=(0,o.useState)(""),[L,U]=(0,o.useState)(""),[J,K]=(0,o.useState)(""),[Q,W]=(0,o.useState)(""),[z,G]=(0,o.useState)(""),[T,V]=(0,o.useState)([]),[Y,H]=(0,o.useState)([]),[X,$]=(0,o.useState)(!0),[ee,es]=(0,o.useState)(!1),[ea,et]=(0,o.useState)(null),[el,en]=(0,o.useState)(null),[ec,eo]=(0,o.useState)(!1),[ei,er]=(0,o.useState)(null),[ed,eu]=(0,o.useState)(!1),[ep,ex]=(0,o.useState)(!1),[eh,em]=(0,o.useState)(null),[ef,ev]=(0,o.useState)(null),[eg,ej]=(0,o.useState)(null),[eb,eS]=(0,o.useState)(null),[ey,eN]=(0,o.useState)(1),[ew,eZ]=(0,o.useState)(10),[eC,e_]=(0,o.useState)(1),[eP,eA]=(0,o.useState)(!1),[eD,ek]=(0,o.useState)([]),[eM,eR]=(0,o.useState)(!1),[eE,eF]=(0,o.useState)(!1),eO=(0,r.useSearchParams)().get("survey_id"),eB=(0,r.useRouter)(),{isLoaded:eI}=(0,x.Ji)({id:"google-map-script",googleMapsApiKey:"AIzaSyAAOwDBvpg5ZDv5JFG-CoDW23GsKkOPeuA"});async function eq(){let s,t;e&&a&&(s=new Date(e||""),t=new Date(a||""),s.setDate(s.getDate()+1),t.setDate(t.getDate()+1));let l={surveyId:eO,startDate:s,endDate:t,userId:I,filters:T,limit:ew,page:eC};es(!0);let n=await (0,i.K7)(l);H(n.data),eN(n.totalPages),console.log("responses of responses ------>",n),n.data&&n.data.length>0&&er(n.data[0].responses.map(e=>({question:e.question,question_id:e.question_id}))),es(!1)}async function eL(){let e=await (0,m.LA)({_id:eO});console.log("current survey-->",e),e.success?(console.log("setting ac_list",e.data.ac_list),eR(e.data.imported),ek(e.data.ac_list),eS(e.data.questions.map(e=>e))):u.ZP.error("Error fetching the survey!")}async function eU(){let e=await (0,d.AW)({selectedRole:Z.py});console.log("users-------->",e.data),A(e.data)}async function eJ(){let e=await (0,d.Yx)({filter:eh});console.log("panna below-------->",e),ev(e)}(0,o.useEffect)(()=>{eq()},[X,eC,ew,I,T]),(0,o.useEffect)(()=>{eL(),eU()},[]),(0,o.useEffect)(()=>{eD.length>0&&eJ()},[eh,eD]);let eK=()=>{k(!1),eQ()},eQ=()=>{U(""),K(""),W("")},eW=async()=>{try{let s,t;eA(!0),e&&a&&(s=new Date(e||""),t=new Date(a||""),s.setDate(s.getDate()+1),t.setDate(t.getDate()+1));let l={surveyId:eO,startDate:s,endDate:t,userId:I,filters:T,download:!0},n="response.xlsx",c=await (0,i.kz)(l),o=c.headers["content-disposition"];console.log("header ======>",o);let r=o.split("filename=")[1].replace(/"/g,"");r&&(n=r);let d=window.URL.createObjectURL(new Blob([c.data])),u=document.createElement("a");u.href=d,u.setAttribute("download",n),document.body.appendChild(u),u.click(),document.body.removeChild(u)}catch(e){u.ZP.error("Failed to export to Excel")}finally{eA(!1)}},ez=null==P?void 0:P.map(e=>({value:e._id,label:e.name}));return(0,t.jsxs)("div",{className:"flex flex-col w-full font-medium bg-light-gray",children:[(0,t.jsxs)("nav",{className:"w-full py-3 px-8 flex flex-col gap-10 font-semibold",children:[(0,t.jsx)("h3",{className:"text-[24px] font-semibold",children:"Survey Response"}),(0,t.jsxs)("div",{className:"flex w-full gap-12",children:[(0,t.jsx)(f.Z,{appliedFilters:T,filters:O,responses:Y,selectedFilter:z,setAppliedFilters:V,setSelectedFilter:G,surveyQuestions:eb}),(0,t.jsxs)("div",{className:"flex space-x-2 text-black text-base font-semibold",children:[(0,t.jsx)(l.Z,{loading:eP,onClick:eW,className:"rounded-[20px] h-fit px-4 py-2 w-44 justify-center",children:"Export to Excel"}),(0,t.jsx)(n.Z,{onClick:()=>eB.back(),className:"rounded-[20px] h-fit px-4 py-2",children:"Back"})]})]})]}),(0,t.jsx)("div",{className:"p-5 font-semibold text-sm ",children:(0,t.jsx)("div",{className:"bg-light-gray space-y-4 w-full rounded-lg px-4 py-6",children:(0,t.jsxs)("div",{className:"w-[780px] space-y-8 pb-6 ",children:[(0,t.jsxs)("div",{className:"flex gap-10",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex gap-3 items-center mb-5",children:[(0,t.jsx)("h1",{className:"",children:"Date Range"}),(0,t.jsx)(y.default,{src:N.Z.src,alt:"calender",height:18,width:18})]}),(0,t.jsx)("div",{className:"w-fit",children:(0,t.jsx)(c.Z,{className:"w-[352px] h-10",startDate:e,endDate:a,setStartDate:s,setEndDate:_})})]}),(0,t.jsx)(l.Z,{className:" flex justify-center items-center h-fit self-end",onClick:()=>{k(!0)},children:"Advanced data filter +"})]}),(0,t.jsxs)("div",{className:"flex gap-5 items-center",children:[(0,t.jsx)("div",{className:"flex flex-col space-y-2 w-[352px]",children:(0,t.jsx)(h.ZP,{value:ez.find(e=>e.value===I),onChange:e=>q((null==e?void 0:e.value)||""),options:ez,placeholder:"Select user",classNamePrefix:"react-select",isSearchable:!0})}),(0,t.jsxs)("div",{className:"flex space-x-4",children:[(0,t.jsx)(n.Z,{onClick:()=>{s(null),_(null),q(""),V([]),$(!X)},className:"bg-dark-gray text-white",children:"Reset"}),(0,t.jsx)(l.Z,{disabled:0===T.length&&!I.trim()&&!e&&!a,onClick:()=>{if(e&&!a||a&&!e){u.ZP.error("Please select a complete date range!");return}eq()},className:"disabled:cursor-not-allowed disabled:bg-primary-100 disabled:text-secondary-100",children:"Apply"})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[eD&&eD.length>0&&(0,t.jsx)(l.Z,{onClick:()=>ex(!0),children:"Assign Data"}),(0,t.jsx)(l.Z,{onClick:()=>eF(!0),children:"Assign Booth"})]})]})})}),ee&&(0,t.jsx)(p.Z,{text:"Fetching responses, please wait...",className:"h-[30vh] w-full flex justify-center items-center"}),!ee&&Y&&Y.length>0?(0,t.jsx)(S.Z,{selectedPanna:eg,more:ea,responses:Y,setMapModalIsOpen:eo,setMore:et,setResponseModalIsOpen:R,setSelectedResponse:en,users:P,assignMode:ed,setAssignedMode:eu,getUserResponses:eq,setSelectedPanna:ej}):!ee&&(0,t.jsx)("div",{className:"flex w-full justify-center items-center h-[30vh]",children:(0,t.jsx)("p",{children:"No responses found"})}),!ee&&(0,t.jsxs)("div",{className:"flex gap-3 items-center mt-4 pl-4 py-3 sticky bottom-0 left-0 bg-[#ECF0FA]",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"limit-select",className:"mr-2",children:"Show:"}),(0,t.jsxs)("select",{id:"limit-select",value:ew,onChange:e=>{eZ(parseInt(e.target.value,10))},className:"p-2 border rounded-md",children:[(0,t.jsx)("option",{value:10,children:"10"}),(0,t.jsx)("option",{value:20,children:"20"}),(0,t.jsx)("option",{value:50,children:"50"}),(0,t.jsx)("option",{value:100,children:"100"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("button",{onClick:()=>{e_(eC-1)},disabled:1===eC,className:"p-2 border rounded-md disabled:opacity-50",children:(0,t.jsx)(w.u1R,{})}),(0,t.jsxs)("span",{children:["Page ",eC," of ",ey]}),(0,t.jsx)("button",{onClick:()=>{e_(eC+1)},disabled:eC===ey,className:"p-2 border rounded-md disabled:opacity-50",children:(0,t.jsx)(w.hjJ,{})})]})]}),(0,t.jsx)(v.Z,{modalIsOpen:D,closeModal:eK,surveyQuestions:eb,question:L,questionType:E,operator:J,response:Q,setQuestionType:F,setQuestion:U,setOperator:K,setResponse:W,saveFilter:()=>{B([...O,{question:L,operator:J,response:Q}]),eK()}}),(0,t.jsx)(g.Z,{responseModalIsOpen:M,selectedResponse:el,setResponseModalIsOpen:R,users:P}),(0,t.jsx)(b.Z,{isLoaded:eI,mapModalIsOpen:ec,setMapModalIsOpen:eo}),(0,t.jsx)(j.Z,{assignMode:ed,pannaPramukh:ef,selectedPanna:eg,setAssignMode:eu,setSelectedPanna:ej,setUserModal:ex,setUserSearch:em,userModal:ep,userSearch:eh||""}),(0,t.jsx)(C.Z,{survey_id:eO||"",acList:eD,boothModal:eE,setBoothModal:eF,isImported:eM})]})}s.default=()=>(0,t.jsx)(o.Suspense,{children:(0,t.jsx)(_,{})})},56806:function(e,s,a){"use strict";var t=a(57437),l=a(2265),n=a(85260),c=a(77902),o=a(76965),i=a(88726),r=a(84298),d=a(1633);s.Z=function(e){let{boothModal:s,setBoothModal:a,acList:u,survey_id:p,isImported:x}=e,h=[{value:d.py,label:"Survey Collector"},{value:d.ZL,label:"District President"},{value:d.af,label:"Shakti Kendra"},{value:d.il,label:"Booth Adhyaksh"},{value:d.aA,label:"Voter Relationship executive"}],[m,f]=(0,l.useState)(h),[v,g]=(0,l.useState)(null),[j,b]=(0,l.useState)([]),[S,y]=(0,l.useState)(""),[N,w]=(0,l.useState)([]),[Z,C]=(0,l.useState)(!1),_=async e=>{try{let s;C(!0),s=v===d.ZL||v===d.af||v===d.il?await (0,r.WC)({role:v}):await (0,r.AW)({selectedRole:e}),console.log("users ---->",s),s.success?b(s.data||[]):i.ZP.error("Failed to fetch users")}catch(e){i.ZP.error("An error occurred while fetching users")}C(!1)};(0,l.useEffect)(()=>{f(x?h:h.filter(e=>"Survey Collector"!==e.label))},[x]),(0,l.useEffect)(()=>{v?(console.log(" ------->",v),_(v)):b([])},[v]);let P=null==j?void 0:j.map(e=>({value:e._id,label:e.name})),A=null==u?void 0:u.map(e=>({value:e.ac_no,label:"AC ".concat(e.ac_no)})),D=(e,s)=>{w(a=>a.map(a=>a.ac_no===e?{...a,booth_numbers:s.map(e=>e.value)}:a))},k=e=>{w(s=>s.filter(s=>s.ac_no!==e))},M=async()=>{if(C(!0),!S||0===N.length){i.ZP.error("Please select all fields"),C(!1);return}let e=N.map(e=>({...e,survey_id:p})),s={survey_id:p,userId:S,ac_list:e};"671f997d38863c2bfc859e76"===v&&(s.editResponses=!0);try{(await (0,r.J2)(s)).success?(i.ZP.success("AC and Booth assigned successfully!"),a(!1)):i.ZP.error("Failed to assign AC and Booth")}catch(e){i.ZP.error("An error occurred during assignment")}finally{C(!1)}};return(0,t.jsx)(n.Z,{open:s,closeModal:()=>a(!1),children:(0,t.jsxs)("div",{className:"min-h-[50vh] max-h-[90vh] flex items-center gap-5 p-8 flex-col bg-secondary-100 overflow-y-auto",children:[(0,t.jsx)("h1",{className:"text-xl font-bold text-primary-300",children:"Assign AC and Booth to User"}),(0,t.jsx)("div",{className:"flex flex-col space-y-2 w-[352px]",children:(0,t.jsx)(c.ZP,{value:m.find(e=>e.value===v),onChange:e=>g((null==e?void 0:e.value)||null),options:m,placeholder:"Select Role",classNamePrefix:"react-select",isSearchable:!0})}),(0,t.jsx)("div",{className:"flex flex-col space-y-2 w-[352px]",children:(0,t.jsx)(c.ZP,{value:P.find(e=>e.value===S),onChange:e=>y((null==e?void 0:e.value)||""),options:P,placeholder:"Select User",classNamePrefix:"react-select",isSearchable:!0,isDisabled:!v})}),(0,t.jsx)("div",{className:"flex flex-col space-y-2 w-[352px]",children:(0,t.jsx)(c.ZP,{onChange:e=>{let s=e.value;N.some(e=>e.ac_no===s)||w([...N,{ac_no:s,booth_numbers:[]}])},options:A,placeholder:"Select AC",classNamePrefix:"react-select",isSearchable:!0})}),N.map(e=>{var s;let a=null===(s=u.find(s=>s.ac_no===e.ac_no))||void 0===s?void 0:s.booth_numbers.map(e=>({value:e,label:"Booth ".concat(e)}));return(0,t.jsxs)("div",{className:"flex flex-col space-y-2 w-[352px]",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("h2",{className:"text-lg font-semibold text-primary-300",children:["AC ",e.ac_no]}),(0,t.jsx)("button",{onClick:()=>k(e.ac_no),className:"text-red-500 underline text-sm",children:"Remove"})]}),(0,t.jsx)(c.ZP,{value:e.booth_numbers.map(e=>null==a?void 0:a.find(s=>s.value===e)),onChange:s=>D(e.ac_no,s||[]),options:a,placeholder:"Select Booths for AC ".concat(e.ac_no),classNamePrefix:"react-select",isSearchable:!0,isMulti:!0})]},e.ac_no)}),(0,t.jsx)(o.Z,{disabled:Z,loading:Z,className:"mt-auto disabled:bg-primary-100",onClick:M,children:"Assign"})]})})}}},function(e){e.O(0,[5223,5452,7699,4574,1544,7240,1910,8472,8726,9413,1181,8143,4049,1071,9693,2274,1805,8780,8155,198,2971,7023,1744],function(){return e(e.s=66320)}),_N_E=e.O()}]);