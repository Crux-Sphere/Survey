(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7135],{20067:function(){},72061:function(){},9546:function(e,s,t){Promise.resolve().then(t.bind(t,5230))},5230:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return Z}});var r=t(57437),n=t(2265),l=t(824),a=t(85260),c=t(76965),o=t(72012);let i=()=>{let e=(0,n.useContext)(o.Z);if(!e)throw Error("useCreateSurveyContext must be used within a CreateSurveyContextProvider");return e};var u=t(16463),d=t(60274),p=t(88726),x=t(4815),h=function(e){let{modalIsOpen:s,closeModal:t,setUpdated:o}=e,{ac_list:h,addAcEntry:m,name:f,removeAcEntry:y,setName:g}=i(),[b,v]=(0,n.useState)(""),[j,N]=(0,n.useState)(""),[w,_]=(0,n.useState)(!1),C=(0,u.useRouter)(),S=async()=>{let e={name:f};h.length>0&&(e.ac_list=h.map(e=>({ac_no:e.ac_no,booth_numbers:e.booth_numbers.split(",").map(e=>e.trim())})));try{_(!0);let s=await (0,d.Vb)(e);s.success&&(p.ZP.success("Survey created successfully!"),console.log("survey--------",s),t(),o(e=>!e),C.push("/admin/surveys/edit?survey_id=".concat(s.survey._id)))}catch(e){console.log("error in creating survey ---=-=-=->",e),p.ZP.error("Something went wrong while creating the survey.")}finally{_(!1)}};return(0,r.jsx)(a.Z,{preventOutsideClose:w,open:s,closeModal:t,children:(0,r.jsxs)("div",{className:"relative w-[50vw] min-h-[60vh] max-h-[90vh] overflow-y-auto vertical-scrollbar-orange flex flex-col items-center",children:[w&&(0,r.jsxs)("div",{className:"absolute inset-0 z-30 bg-black/65 flex flex-col justify-center items-center gap-10 h-full w-full",children:[(0,r.jsx)(x.Z,{speedMultiplier:1.25,color:"#FF8437"}),(0,r.jsx)("h3",{className:"text-white font-semibold",children:"Getting survey ready..."})]}),(0,r.jsx)("div",{className:"sticky top-0 left-0 z-10 text-primary-300 px-8 py-4 text-[24px] bg-white font-bold border-b w-full",children:"Create surveys"}),(0,r.jsxs)("div",{className:"flex p-4 gap-5 justify-center w-full h-full",children:[(0,r.jsx)("img",{src:"/images/create-survey.png",className:"w-[300px] h-[223px]"}),(0,r.jsxs)("form",{className:"grid grid-cols-4 gap-5 w-full h-fit place-items-center",children:[(0,r.jsx)("input",{onChange:e=>g(e.target.value),value:f,className:"col-span-4 flex items-center border border-secondary-200 rounded-[20px] px-8 py-4 h-full w-full focus:ring-2 focus:ring-primary-50 outline-none",type:"text",placeholder:"Survey name"}),(0,r.jsx)("input",{onChange:e=>v(e.target.value),value:b,className:"col-span-4 flex items-center border border-secondary-200 rounded-[20px] px-8 py-4 h-full w-full focus:ring-2 focus:ring-primary-50 outline-none",type:"text",placeholder:"AC_NO"}),(0,r.jsx)("input",{onChange:e=>N(e.target.value),value:j,className:"col-span-4 flex items-center border border-secondary-200 rounded-[20px] px-8 py-4 h-full w-full focus:ring-2 focus:ring-primary-50 outline-none",type:"text",placeholder:"BOOTH_NO (comma-separated)"})]})]}),(0,r.jsx)("div",{className:"w-full px-4",children:h.map((e,s)=>(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("span",{className:"text-primary-300 font-bold",children:["AC_NO: ",e.ac_no]}),(0,r.jsxs)("span",{children:["Booth Numbers: ",e.booth_numbers]})]}),(0,r.jsx)("button",{type:"button",onClick:()=>y(s),className:"text-red-500 font-semibold",children:"Remove"})]},s))}),(0,r.jsxs)("div",{className:"sticky bottom-0 ri justify-end p-4 flex items-center gap-10 z-20 bg-white w-full",children:[(0,r.jsx)(l.Z,{onClick:t,type:"button",className:"border-secondary-200",children:"Cancel"}),(0,r.jsx)(c.Z,{type:"button",onClick:()=>{v(""),N(""),m(b,j)},className:"col-span-4 px-4 py-2 bg-primary-300 text-white rounded-md",children:"Add AC_NO"}),(0,r.jsx)(c.Z,{disabled:!f,className:"px-6 py-2 bg-primary-300 text-white rounded-md disabled:bg-primary-100 disabled:cursor-not-allowed",type:"button",onClick:S,children:"Create Survey"})]})]})})},m=t(60152),f=t(27800),y=t(95650),g=t(80106),b=function(e){let{importModalOpen:s,closeImportModal:t,setUpdated:c}=e,[o,i]=(0,n.useState)(""),[u,h]=(0,n.useState)(null),[b,v]=(0,n.useState)([]),[j,N]=(0,n.useState)(!1),[w,_]=(0,n.useState)(!1),[C,S]=(0,n.useState)(!1),[O,Z]=(0,n.useState)("Getting survey ready...");(0,n.useEffect)(()=>{h((0,y.a_)())},[]);let A=(0,n.useRef)(null),k=async e=>{var s;e.preventDefault();let r=null===(s=e.target.files)||void 0===s?void 0:s[0];if(r){let e;N(!0);let s=new FileReader;s.onload=async s=>{var r;Z("Parsing Excel file...");let n=new Uint8Array(null===(r=s.target)||void 0===r?void 0:r.result),l=f.ij(n,{type:"array"}),a=l.SheetNames[0],i=l.Sheets[a];console.log("json data iis ------->",e=f.P6.sheet_to_json(i)),console.log("json data length iis ------->",e.length);let x=[],h={};e.forEach(e=>{let s="".concat(e.AC_NO,"-").concat(e.BOOTH_NO);h[s]||(h[s]=!0,x.push({AC_NO:e.AC_NO,BOOTH_NO:e.BOOTH_NO}))}),console.log("unique pairs ---->",x);let m={};x.forEach(e=>{m[e.AC_NO]||(m[e.AC_NO]=[]),m[e.AC_NO]=[...m[e.AC_NO],e.BOOTH_NO]}),console.log("ac_object is --->",m);let y=Object.keys(m).map(e=>({ac_no:e,booth_numbers:m[e]}));if(console.log("ac_list is ===>",y),u){let s=[];Object.keys(e[0]).forEach((e,t)=>{["AC_NO","BOOTH_NO"].includes(e)||s.push({question_id:t+10,type:"Single line Text Input",randomize:!1,common:!1,dependency:[],children:[],parameters:{question:e}})});let r={name:o,ac_list:y,imported:!0,response_count:e.length,published:!1,questions:s};Z("Creating survey..."),_(!0);let n=await (0,d.Vb)(r);if(_(!1),n.success){p.ZP.success("Survey created successfully!");let s=[];Z("Preparing responses..."),e.forEach((e,t)=>{let r=[];Object.keys(e).forEach((s,t)=>{if(["AC_NO","BOOTH_NO"].includes(s))return;let n={};n.response=String(e[s]),n.question_id=t+10,n.question=s,n.question_type="Single line Text Input",r.push(n)}),s.push({survey_id:n.survey._id,ac_no:e.AC_NO,booth_no:e.BOOTH_NO,house_no:e.houseno,phone_no:e.MOBILE_NO,name:e["Voter Name"],responses:r})}),console.log("all-responses -->",s),Z("Saving responses..."),E(s)}else p.ZP.error("Failed to create survey!");t(),c(e=>!e)}v(e),N(!1)},s.readAsArrayBuffer(r)}};async function E(e){S(!0);let s=await (0,m.Pt)(e);console.log("saving responses response --->",s),s.success?p.ZP.success("Responses saved successfully"):p.ZP.error("Something went wrong while saving responses"),S(!1)}return C?(0,r.jsx)(g.Z,{text:"Saving families and responses, this might take a while..."}):(0,r.jsx)(a.Z,{open:s,closeModal:t,children:(0,r.jsxs)("div",{className:"relative min-w-[600px] h-[400px] flex flex-col justify-center items-center",children:[(j||C)&&(0,r.jsxs)("div",{className:"absolute inset-0 z-30 bg-black/65 flex flex-col justify-center items-center gap-10 h-full w-full",children:[(0,r.jsx)(x.Z,{speedMultiplier:1.25,color:"#FF8437"}),(0,r.jsx)("h3",{className:"text-white font-semibold",children:O})]}),(0,r.jsx)("div",{className:"relative z-10 text-primary-300 px-8 py-4 text-[24px] font-bold border-b w-full",children:"Import survey"}),(0,r.jsxs)("div",{className:"flex w-full h-full p-4",children:[(0,r.jsx)("img",{src:"/images/create-survey.png",className:"w-[300px] h-[223px]"}),(0,r.jsxs)("form",{className:"flex flex-col w-full gap-2",children:[(0,r.jsx)("input",{onChange:e=>i(e.target.value),value:o,className:"flex items-center border border-secondary-200 rounded-md px-8 py-3 w-full focus:ring-1 focus:ring-blue-200 outline-none",type:"text",placeholder:"Survey name"}),(0,r.jsxs)("div",{className:"flex items-center gap-10 mt-auto",children:[(0,r.jsx)(l.Z,{onClick:t,type:"button",className:"border-secondary-200",children:"Cancel"}),(0,r.jsxs)("label",{children:[(0,r.jsx)("input",{ref:A,type:"file",accept:".xlsx, .xls",onChange:k,className:"hidden"}),(0,r.jsx)("button",{type:"button",onClick:()=>{A.current&&A.current.click()},disabled:!o,className:"px-6 py-2 bg-primary-300 text-white rounded-md disabled:bg-primary-100 disabled:cursor-not-allowed",children:"Import questions"})]})]})]})]})]})})},v=t(69824),j=t(50731),N=function(e){let{setUpdated:s}=e,[t,l]=(0,n.useState)(!1),[a,o]=(0,n.useState)(!1),{setName:u,setAcList:d}=i();return(0,r.jsxs)("header",{className:"top-0 left-0 z-20 w-full h-16",children:[(0,r.jsxs)("div",{className:"h-16 w-full py-3 px-8 flex justify-between ",children:[(0,r.jsx)("h3",{className:"text-secondary-300 text-2xl",children:"Surveys"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(c.Z,{onClick:()=>l(!0),className:" font-semibold gap-2",children:[" ",(0,r.jsx)("p",{className:"text-2xl",children:(0,r.jsx)(v.S$f,{})})," ",(0,r.jsx)("p",{children:"Create survey"})]}),(0,r.jsxs)(c.Z,{onClick:()=>o(!0),className:"flex gap-2 items-center  font-semibold",children:[(0,r.jsx)(j.o5r,{className:"text-2xl"}),(0,r.jsx)("p",{children:"Import survey"})]})]})]}),(0,r.jsx)(h,{setUpdated:s,modalIsOpen:t,closeModal:()=>{u(""),d([]),l(!1)}}),(0,r.jsx)(b,{setUpdated:s,importModalOpen:a,closeImportModal:()=>o(!1)})]})},w=t(31894),_=t(66648),C=t(38804),S=t(17042);let O={page:1,limit:10,sortBy:"createdAt",sortOrder:"desc",published:"all",created_by:"rohitchand490@gmail.com",filter:""};var Z=function(){let[e,s]=(0,n.useState)(O),[t,l]=(0,n.useState)(""),[a,o]=(0,n.useState)("all"),[i,u]=(0,n.useState)("dateDesc"),[d,p]=(0,n.useState)(!1),x=(0,S.Z)(),h=null==x?void 0:x.role.map(e=>e.name).includes("Survey Manager");return(0,n.useEffect)(()=>{},[e]),(0,r.jsxs)("section",{className:" bg-[#ECF0FA] min-h-[calc(100vh-80px)] w-full flex flex-col",children:[!h&&(0,r.jsx)(N,{setUpdated:p}),(0,r.jsx)("div",{className:"p-3 text-sm text-my-gray-200 bg-white mx-5 rounded-xl my-2",children:(0,r.jsxs)("div",{className:"flex gap-10 justify-between items-center",children:[(0,r.jsx)("input",{className:"w-[387px] h-[42.5px] px-4 py-[10px] border border-secondary-200 rounded-md focus:outline-none text-[14px] text-secondary-300",placeholder:"Search Surveys here",value:t,onChange:e=>l(e.target.value)}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex  h-10 items-center space-x-1 text-secondary-300 font-semibold text-[14px] whitespace-nowrap",children:[(0,r.jsx)("p",{children:"Filter By:"}),(0,r.jsx)("div",{className:"rounded-md py-2 px-2 justify-between border border-secondary-200 bg-white",children:(0,r.jsxs)("select",{name:"filterby",className:"w-fit bg-white  focus:outline-none px-2",id:"filterby",value:a,onChange:e=>o(e.target.value),children:[(0,r.jsx)("option",{value:"all",children:"All"}),(0,r.jsx)("option",{value:"published",children:"Published"}),(0,r.jsx)("option",{value:"unpublished",children:"Unpublished"})]})})]}),(0,r.jsxs)("div",{className:"flex h-10 items-center space-x-1 mr-8 text-secondary-300 font-semibold text-[14px] whitespace-nowrap",children:[(0,r.jsx)("p",{className:"",children:"Sort By:"}),(0,r.jsx)("div",{className:"rounded-md py-2 px-2 justify-between border border-secondary-200 bg-white",children:(0,r.jsxs)("select",{name:"sortby",className:"w-fit bg-white focus:outline-none px-2",id:"sortby",value:i,onChange:e=>u(e.target.value),children:[(0,r.jsx)("option",{value:"nameAsc",children:"Name ASC"}),(0,r.jsx)("option",{value:"nameDesc",children:"Name DESC"}),(0,r.jsx)("option",{value:"dateDesc",children:"Date DESC"}),(0,r.jsx)("option",{value:"dateAsc",children:"Date ASC"})]})})]}),(0,r.jsxs)(c.Z,{className:"text-[14px] font-semibold flex gap-2 items-center justify-center",onClick:()=>{s(e=>({...e,filter:t,published:a,sortBy:i.includes("name")?"name":"createdAt",sortOrder:i.includes("Asc")?"asc":"desc",page:1}))},children:[(0,r.jsx)(_.default,{src:w.Z.src,alt:"filter icon",height:20,width:20}),(0,r.jsx)("p",{className:"whitespace-nowrap",children:"Apply filters"})]}),(0,r.jsx)(c.Z,{className:"text-[14px] font-semibold flex gap-2 items-center justify-center bg-dark-gray",onClick:()=>{l(""),o("all"),u("dateDesc"),s(()=>O)},children:(0,r.jsx)("p",{className:"whitespace-nowrap",children:"Clear Filters"})})]})]})}),(0,r.jsx)(C.Z,{updated:d,setQueryParams:e=>s(s=>({...s,...e})),queryParams:e})]})}},824:function(e,s,t){"use strict";var r=t(57437);t(2265);var n=t(96164);s.Z=function(e){let{children:s,className:t,...l}=e;return(0,r.jsx)("button",{...l,className:(0,n.m6)("border border-primary-300 px-4 py-2 rounded-[20px] text-primary-300 hover:text-white hover:bg-primary-300",t),children:s})}},60152:function(e,s,t){"use strict";t.d(s,{Bu:function(){return i},K7:function(){return c},Pt:function(){return l},kz:function(){return o},qn:function(){return u},sD:function(){return a}});var r=t(1633),n=t(38472);let l=async e=>{try{let s={method:"POST",url:"".concat(r.M6,"/").concat(r.vx),data:e},t=await n.Z.request(s);return console.log(t),t.data}catch(e){return{success:!1,message:"Something Went Wrong",error:e}}},a=async e=>{try{let s={method:"GET",url:"".concat(r.M6,"/").concat(r.HA),params:e};return(await n.Z.request(s)).data}catch(e){return{success:!1,message:"Something Went Wrong",error:e}}},c=async e=>{try{let s={method:"GET",url:"".concat(r.M6,"/").concat(r.jC),params:e},t=await n.Z.request(s);return console.log("response --->",t),t.data}catch(e){return{success:!1,message:"Something Went Wrong",error:e}}},o=async e=>{try{let s={method:"GET",url:"".concat(r.M6,"/").concat(r.jC),params:e,responseType:"blob"},t=await n.Z.request(s);return console.log("response --->",t),t}catch(e){return{success:!1,message:"Something Went Wrong",error:e}}},i=async e=>{try{let s={method:"POST",url:"".concat(r.M6,"/").concat(r.L5),data:e},t=await n.Z.request(s);return console.log("response --->",t),t.data}catch(e){return{success:!1,message:"Something Went Wrong",error:e}}},u=async e=>{try{let s={method:"POST",url:"".concat(r.M6,"/").concat(r.Gb),data:e},t=await n.Z.request(s);return console.log("response --->",t),t.data}catch(e){return{success:!1,message:"Something Went Wrong",error:e}}}},72012:function(e,s,t){"use strict";t.d(s,{r:function(){return a}});var r=t(57437),n=t(2265);let l=(0,n.createContext)(void 0);function a(e){let{children:s}=e,[t,a]=(0,n.useState)(""),[c,o]=(0,n.useState)([]);return(0,r.jsx)(l.Provider,{value:{name:t,ac_list:c,setName:a,addAcEntry:(e,s)=>{o(t=>[...t,{ac_no:e,booth_numbers:s}])},removeAcEntry:e=>{o(s=>s.filter((s,t)=>t!==e))},setAcList:o},children:s})}s.Z=l}},function(e){e.O(0,[5452,7699,6051,1779,1694,1425,8472,8726,9413,1181,8143,4049,1071,9693,553,2971,7023,1744],function(){return e(e.s=9546)}),_N_E=e.O()}]);