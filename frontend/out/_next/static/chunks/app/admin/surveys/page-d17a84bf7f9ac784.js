(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7135],{20067:function(){},72061:function(){},9546:function(e,t,s){Promise.resolve().then(s.bind(s,5230))},5230:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return O}});var r=s(57437),l=s(2265),n=s(824),a=s(85260),c=s(76965),o=s(72012);let i=()=>{let e=(0,l.useContext)(o.Z);if(!e)throw Error("useCreateSurveyContext must be used within a CreateSurveyContextProvider");return e};var u=s(16463),d=s(60274),p=s(88726),x=s(4815),h=function(e){let{modalIsOpen:t,closeModal:s,setUpdated:o}=e,{ac_list:h,addAcEntry:m,name:f,removeAcEntry:y,setName:g}=i(),[b,v]=(0,l.useState)(""),[j,N]=(0,l.useState)(""),[w,C]=(0,l.useState)(!1),S=(0,u.useRouter)(),_=async()=>{let e={name:f};h.length>0&&(e.ac_list=h.map(e=>({ac_no:e.ac_no,booth_numbers:e.booth_numbers.split(",").map(e=>e.trim())})));try{C(!0);let t=await (0,d.Vb)(e);t.success&&(p.ZP.success("Survey created successfully!"),console.log("survey--------",t),s(),o(e=>!e),S.push("/admin/surveys/edit?survey_id=".concat(t.survey._id)))}catch(e){console.log("error in creating survey ---=-=-=->",e),p.ZP.error("Something went wrong while creating the survey.")}finally{C(!1)}};return(0,r.jsx)(a.Z,{preventOutsideClose:w,open:t,closeModal:s,children:(0,r.jsxs)("div",{className:"relative w-[50vw] min-h-[60vh] max-h-[90vh] overflow-y-auto vertical-scrollbar-orange flex flex-col items-center",children:[w&&(0,r.jsxs)("div",{className:"absolute inset-0 z-30 bg-black/65 flex flex-col justify-center items-center gap-10 h-full w-full",children:[(0,r.jsx)(x.Z,{speedMultiplier:1.25,color:"#FF8437"}),(0,r.jsx)("h3",{className:"text-white font-semibold",children:"Getting survey ready..."})]}),(0,r.jsx)("div",{className:"sticky top-0 left-0 z-10 text-primary-300 px-8 py-4 text-[24px] bg-white font-bold border-b w-full",children:"Create surveys"}),(0,r.jsxs)("div",{className:"flex p-4 gap-5 justify-center w-full h-full",children:[(0,r.jsx)("img",{src:"/images/create-survey.png",className:"w-[300px] h-[223px]"}),(0,r.jsxs)("form",{className:"grid grid-cols-4 gap-5 w-full h-fit place-items-center",children:[(0,r.jsx)("input",{onChange:e=>g(e.target.value),value:f,className:"col-span-4 flex items-center border border-secondary-200 rounded-[20px] px-8 py-4 h-full w-full focus:ring-2 focus:ring-primary-50 outline-none",type:"text",placeholder:"Survey name"}),(0,r.jsx)("input",{onChange:e=>v(e.target.value),value:b,className:"col-span-4 flex items-center border border-secondary-200 rounded-[20px] px-8 py-4 h-full w-full focus:ring-2 focus:ring-primary-50 outline-none",type:"text",placeholder:"AC_NO"}),(0,r.jsx)("input",{onChange:e=>N(e.target.value),value:j,className:"col-span-4 flex items-center border border-secondary-200 rounded-[20px] px-8 py-4 h-full w-full focus:ring-2 focus:ring-primary-50 outline-none",type:"text",placeholder:"BOOTH_NO (comma-separated)"})]})]}),(0,r.jsx)("div",{className:"w-full px-4",children:h.map((e,t)=>(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("span",{className:"text-primary-300 font-bold",children:["AC_NO: ",e.ac_no]}),(0,r.jsxs)("span",{children:["Booth Numbers: ",e.booth_numbers]})]}),(0,r.jsx)("button",{type:"button",onClick:()=>y(t),className:"text-red-500 font-semibold",children:"Remove"})]},t))}),(0,r.jsxs)("div",{className:"sticky bottom-0 ri justify-end p-4 flex items-center gap-10 z-20 bg-white w-full",children:[(0,r.jsx)(n.Z,{onClick:s,type:"button",className:"border-secondary-200",children:"Cancel"}),(0,r.jsx)(c.Z,{type:"button",onClick:()=>{v(""),N(""),m(b,j)},className:"col-span-4 px-4 py-2 bg-primary-300 text-white rounded-md",children:"Add AC_NO"}),(0,r.jsx)(c.Z,{disabled:!f,className:"px-6 py-2 bg-primary-300 text-white rounded-md disabled:bg-primary-100 disabled:cursor-not-allowed",type:"button",onClick:_,children:"Create Survey"})]})]})})},m=s(60152),f=s(27800),y=s(95650),g=function(e){let{importModalOpen:t,closeImportModal:s,setUpdated:c}=e,[o,i]=(0,l.useState)(""),[u,h]=(0,l.useState)(""),[g,b]=(0,l.useState)(""),[v,j]=(0,l.useState)(null),[N,w]=(0,l.useState)([]),[C,S]=(0,l.useState)(!1);(0,l.useEffect)(()=>{j((0,y.a_)())},[]);let _=(0,l.useRef)(null),O=async e=>{var t;S(!0),e.preventDefault();let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){let e;let t=new FileReader;t.onload=async t=>{var r;let l=new Uint8Array(null===(r=t.target)||void 0===r?void 0:r.result),n=f.ij(l,{type:"array"}),a=n.SheetNames[0],o=n.Sheets[a];console.log("json data iis ------->",e=f.P6.sheet_to_json(o)),console.log("json data length iis ------->",e.length);let i=[],u={};e.forEach(e=>{let t="".concat(e.AC_NO,"-").concat(e.SECTION_NO);u[t]||(u[t]=!0,i.push({AC_NO:e.AC_NO,SECTION_NO:e.BOOTH_NO}))}),console.log("unique pairs ---->",i);let x={};i.forEach(e=>{x[e.AC_NO]||(x[e.AC_NO]=[]),x[e.AC_NO]=[...x[e.AC_NO],e.SECTION_NO]}),console.log("ac_object is --->",x);let h=Object.keys(x).map(e=>({ac_no:e,booth_numbers:x[e]}));if(console.log("ac_list is ===>",h),v){let t=[];Object.keys(e[0]).forEach((e,s)=>{["AC_NO","SECTION_NO"].includes(e)||t.push({question_id:s+10,type:"Single line Text Input",randomize:!1,common:!1,dependency:[],children:[],parameters:{question:e}})});let r={name:g,ac_list:h,imported:!0,response_count:e.length,published:!1,questions:t};console.log("survey structure --- >",r);let l=await (0,d.Vb)(r);if(l.success){p.ZP.success("Survey created successfully!");let t=[];e.forEach((e,s)=>{let r=[];Object.keys(e).forEach((t,s)=>{if(["AC_NO","SECTION_NO"].includes(t))return;let l={};l.response=String(e[t]),l.question_id=s+10,l.question=t,l.question_type="Single line Text Input",r.push(l)}),t.push({survey_id:l.survey._id,ac_no:e.AC_NO,booth_no:e.BOOTH_NO,house_no:e.houseno,phone_no:e.MOBILE_NO,name:e["Voter Name"],responses:r})}),console.log("all-responses -->",t),A(t)}else p.ZP.error("Failed to create survey!");s(),c(e=>!e)}w(e)},t.readAsArrayBuffer(r),S(!1)}};async function A(e){(await (0,m.Pt)(e)).success?p.ZP.success("Responses saved successfully"):p.ZP.error("Something went wrong while saving responses")}return(0,r.jsx)(a.Z,{open:t,closeModal:s,children:(0,r.jsxs)("div",{className:"relative min-w-[600px] h-[400px] flex flex-col justify-center items-center",children:[C&&(0,r.jsxs)("div",{className:"absolute inset-0 z-30 bg-black/65 flex flex-col justify-center items-center gap-10 h-full w-full",children:[(0,r.jsx)(x.Z,{speedMultiplier:1.25,color:"#FF8437"}),(0,r.jsx)("h3",{className:"text-white font-semibold",children:"Getting survey ready..."})]}),(0,r.jsx)("div",{className:"relative z-10 text-primary-300 px-8 py-4 text-[24px] font-bold border-b w-full",children:"Import survey"}),(0,r.jsxs)("div",{className:"flex w-full h-full p-4",children:[(0,r.jsx)("img",{src:"/images/create-survey.png",className:"w-[300px] h-[223px]"}),(0,r.jsxs)("form",{className:"flex flex-col w-full gap-2",children:[(0,r.jsx)("input",{onChange:e=>b(e.target.value),value:g,className:"flex items-center border border-secondary-200 rounded-md px-8 py-3 w-full focus:ring-1 focus:ring-blue-200 outline-none",type:"text",placeholder:"Survey name"}),(0,r.jsxs)("div",{className:"flex items-center gap-10 mt-auto",children:[(0,r.jsx)(n.Z,{onClick:s,type:"button",className:"border-secondary-200",children:"Cancel"}),(0,r.jsxs)("label",{children:[(0,r.jsx)("input",{ref:_,type:"file",accept:".xlsx, .xls",onChange:O,className:"hidden"}),(0,r.jsx)("button",{type:"button",onClick:()=>{_.current&&_.current.click()},disabled:!g,className:"px-6 py-2 bg-primary-300 text-white rounded-md disabled:bg-primary-100 disabled:cursor-not-allowed",children:"Import questions"})]})]})]})]})]})})},b=s(69824),v=s(50731),j=function(e){let{setUpdated:t}=e,[s,n]=(0,l.useState)(!1),[a,o]=(0,l.useState)(!1),{setName:u,setAcList:d}=i();return(0,r.jsxs)("header",{className:"top-0 left-0 z-20 w-full h-16",children:[(0,r.jsxs)("div",{className:"h-16 w-full py-3 px-8 flex justify-between ",children:[(0,r.jsx)("h3",{className:"text-secondary-300 text-2xl",children:"Surveys"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(c.Z,{onClick:()=>n(!0),className:" font-semibold gap-2",children:[" ",(0,r.jsx)("p",{className:"text-2xl",children:(0,r.jsx)(b.S$f,{})})," ",(0,r.jsx)("p",{children:"Create survey"})]}),(0,r.jsxs)(c.Z,{onClick:()=>o(!0),className:"flex gap-2 items-center  font-semibold",children:[(0,r.jsx)(v.o5r,{className:"text-2xl"}),(0,r.jsx)("p",{children:"Import survey"})]})]})]}),(0,r.jsx)(h,{setUpdated:t,modalIsOpen:s,closeModal:()=>{u(""),d([]),n(!1)}}),(0,r.jsx)(g,{setUpdated:t,importModalOpen:a,closeImportModal:()=>o(!1)})]})},N=s(31894),w=s(66648),C=s(38804),S=s(17042);let _={page:1,limit:10,sortBy:"createdAt",sortOrder:"desc",published:"all",created_by:"rohitchand490@gmail.com",filter:""};var O=function(){let[e,t]=(0,l.useState)(_),[s,n]=(0,l.useState)(""),[a,o]=(0,l.useState)("all"),[i,u]=(0,l.useState)("dateDesc"),[d,p]=(0,l.useState)(!1),x=(0,S.Z)(),h=null==x?void 0:x.role.map(e=>e.name).includes("Survey Manager");return(0,l.useEffect)(()=>{},[e]),(0,r.jsxs)("section",{className:" bg-[#ECF0FA] min-h-[calc(100vh-80px)] w-full flex flex-col",children:[!h&&(0,r.jsx)(j,{setUpdated:p}),(0,r.jsx)("div",{className:"p-3 text-sm text-my-gray-200 bg-white mx-5 rounded-xl my-2",children:(0,r.jsxs)("div",{className:"flex gap-10 justify-between items-center",children:[(0,r.jsx)("input",{className:"w-[387px] h-[42.5px] px-4 py-[10px] border border-secondary-200 rounded-md focus:outline-none text-[14px] text-secondary-300",placeholder:"Search Surveys here",value:s,onChange:e=>n(e.target.value)}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex  h-10 items-center space-x-1 text-secondary-300 font-semibold text-[14px] whitespace-nowrap",children:[(0,r.jsx)("p",{children:"Filter By:"}),(0,r.jsx)("div",{className:"rounded-md py-2 px-2 justify-between border border-secondary-200 bg-white",children:(0,r.jsxs)("select",{name:"filterby",className:"w-fit bg-white  focus:outline-none px-2",id:"filterby",value:a,onChange:e=>o(e.target.value),children:[(0,r.jsx)("option",{value:"all",children:"All"}),(0,r.jsx)("option",{value:"published",children:"Published"}),(0,r.jsx)("option",{value:"unpublished",children:"Unpublished"})]})})]}),(0,r.jsxs)("div",{className:"flex h-10 items-center space-x-1 mr-8 text-secondary-300 font-semibold text-[14px] whitespace-nowrap",children:[(0,r.jsx)("p",{className:"",children:"Sort By:"}),(0,r.jsx)("div",{className:"rounded-md py-2 px-2 justify-between border border-secondary-200 bg-white",children:(0,r.jsxs)("select",{name:"sortby",className:"w-fit bg-white focus:outline-none px-2",id:"sortby",value:i,onChange:e=>u(e.target.value),children:[(0,r.jsx)("option",{value:"nameAsc",children:"Name ASC"}),(0,r.jsx)("option",{value:"nameDesc",children:"Name DESC"}),(0,r.jsx)("option",{value:"dateDesc",children:"Date DESC"}),(0,r.jsx)("option",{value:"dateAsc",children:"Date ASC"})]})})]}),(0,r.jsxs)(c.Z,{className:"text-[14px] font-semibold flex gap-2 items-center justify-center",onClick:()=>{t(e=>({...e,filter:s,published:a,sortBy:i.includes("name")?"name":"createdAt",sortOrder:i.includes("Asc")?"asc":"desc",page:1}))},children:[(0,r.jsx)(w.default,{src:N.Z.src,alt:"filter icon",height:20,width:20}),(0,r.jsx)("p",{className:"whitespace-nowrap",children:"Apply filters"})]}),(0,r.jsx)(c.Z,{className:"text-[14px] font-semibold flex gap-2 items-center justify-center bg-dark-gray",onClick:()=>{n(""),o("all"),u("dateDesc"),t(()=>_)},children:(0,r.jsx)("p",{className:"whitespace-nowrap",children:"Clear Filters"})})]})]})}),(0,r.jsx)(C.Z,{updated:d,setQueryParams:e=>t(t=>({...t,...e})),queryParams:e})]})}},824:function(e,t,s){"use strict";var r=s(57437);s(2265);var l=s(96164);t.Z=function(e){let{children:t,className:s,...n}=e;return(0,r.jsx)("button",{...n,className:(0,l.m6)("border border-primary-300 px-4 py-2 rounded-[20px] text-primary-300 hover:text-white hover:bg-primary-300",s),children:t})}},60152:function(e,t,s){"use strict";s.d(t,{Bu:function(){return i},K7:function(){return c},Pt:function(){return n},kz:function(){return o},qn:function(){return u},sD:function(){return a}});var r=s(1633),l=s(38472);let n=async e=>{try{let t={method:"POST",url:"".concat(r.M6,"/").concat(r.vx),data:e},s=await l.Z.request(t);return console.log(s),s.data}catch(e){return{success:!1,message:"Something Went Wrong",error:e}}},a=async e=>{try{let t={method:"GET",url:"".concat(r.M6,"/").concat(r.HA),params:e};return(await l.Z.request(t)).data}catch(e){return{success:!1,message:"Something Went Wrong",error:e}}},c=async e=>{try{let t={method:"GET",url:"".concat(r.M6,"/").concat(r.jC),params:e},s=await l.Z.request(t);return console.log("response --->",s),s.data}catch(e){return{success:!1,message:"Something Went Wrong",error:e}}},o=async e=>{try{let t={method:"GET",url:"".concat(r.M6,"/").concat(r.jC),params:e,responseType:"blob"},s=await l.Z.request(t);return console.log("response --->",s),s}catch(e){return{success:!1,message:"Something Went Wrong",error:e}}},i=async e=>{try{let t={method:"POST",url:"".concat(r.M6,"/").concat(r.L5),data:e},s=await l.Z.request(t);return console.log("response --->",s),s.data}catch(e){return{success:!1,message:"Something Went Wrong",error:e}}},u=async e=>{try{let t={method:"POST",url:"".concat(r.M6,"/").concat(r.Gb),data:e},s=await l.Z.request(t);return console.log("response --->",s),s.data}catch(e){return{success:!1,message:"Something Went Wrong",error:e}}}},72012:function(e,t,s){"use strict";s.d(t,{r:function(){return a}});var r=s(57437),l=s(2265);let n=(0,l.createContext)(void 0);function a(e){let{children:t}=e,[s,a]=(0,l.useState)(""),[c,o]=(0,l.useState)([]);return(0,r.jsx)(n.Provider,{value:{name:s,ac_list:c,setName:a,addAcEntry:(e,t)=>{o(s=>[...s,{ac_no:e,booth_numbers:t}])},removeAcEntry:e=>{o(t=>t.filter((t,s)=>s!==e))},setAcList:o},children:t})}t.Z=n}},function(e){e.O(0,[5452,7699,6051,1779,1694,1425,8472,8726,9413,1181,8143,4049,1071,9693,553,2971,7023,1744],function(){return e(e.s=9546)}),_N_E=e.O()}]);