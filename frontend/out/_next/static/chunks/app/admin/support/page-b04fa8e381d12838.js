(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1679],{4522:function(e,t,n){Promise.resolve().then(n.bind(n,44998))},44998:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return _}});var r=n(57437),s=n(2265),a=n(28196),l=n(43781),c=n(76965),o=n(66648),i=e=>{let{user:t,alt:n,isOnline:a,width:l,height:c}=e,[i,u]=(0,s.useState)("/_next/static/media/olivia_profile.57c3617a.png");return(0,s.useEffect)(()=>{if(t&&t.profile_picture){let e=t.profile_picture.data,n=t.profile_picture.type;u("data:".concat(n,";base64,").concat(e))}},[t]),(0,r.jsxs)("div",{className:"relative inline-block",children:[(0,r.jsx)(o.default,{src:i,alt:n,width:l||45,height:c||45,className:"rounded-full"}),(0,r.jsx)("span",{className:"absolute bottom-0 right-0 block h-3 w-3 rounded-full ring-2 ring-white\n          ".concat(a?"bg-green-online":"bg-red-offline")})]})};function u(e){let{otherUserData:t}=e;return(0,r.jsxs)("div",{className:"w-full h-20 flex shadow-md justify-between px-4 items-center mb-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-8",children:[(0,r.jsx)(i,{user:t,isOnline:t.isOnline,alt:"profile pic"}),(0,r.jsx)("p",{className:"text-[20px] font-medium",children:null==t?void 0:t.name})]}),(0,r.jsx)("button",{className:"text-white bg-primary-300 rounded-lg p-2",children:(0,r.jsx)(a.jIu,{size:25})})]})}function d(e){let{messages:t,currentUserId:n}=e,a=(0,s.useRef)(null),l=()=>{var e;null===(e=a.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})};return(0,s.useEffect)(()=>{l()},[t]),(0,r.jsxs)("div",{className:"w-full h-full flex flex-1 flex-col overflow-y-auto px-4 ",children:[t.map(e=>{let t=new Date(e.createdAt),s=t.getHours(),a=t.getMinutes(),l=s>=12?"PM":"AM";return s%=12,s=s||12,(0,r.jsx)("div",{className:"mb-4 w-full flex ".concat(e.sender===n?"justify-end":"justify-start"," "),children:(0,r.jsxs)("div",{className:"max-w-[70%] mt-1 flex p-3 rounded-lg items-end gap-2 ".concat(e.sender===n?"bg-primary-300":"bg-[#85a7ff]"," text-white"),children:[(0,r.jsx)("p",{className:"break-words font-medium mb-1",children:e.content}),(0,r.jsx)("p",{className:"min-w-16 text-[12px] text-my-gray-100 mt-1 text-right",children:"".concat(s,":").concat(a<10?"0"+a:a," ").concat(l)})]})},e._id)}),(0,r.jsx)("div",{ref:a})]})}function f(e){let{sendMessage:t}=e,[n,a]=(0,s.useState)(""),o=()=>{n.trim()&&(t(n),a(""))};return(0,r.jsxs)("div",{className:"w-full p-2 pt-1 flex justify-center items-center gap-4",children:[(0,r.jsx)("input",{className:"w-full h-14 px-4 py-3 border border-secondary-200 rounded-lg focus:outline-none text-md text-secondary-300",placeholder:"Type a message",value:n,onChange:e=>a(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),o())}}),(0,r.jsx)(c.Z,{className:"h-14 bg-my-blue-600",onClick:o,children:"Send"}),(0,r.jsx)(c.Z,{className:"w-16 h-14",children:(0,r.jsx)(l.RGt,{size:30})})]})}function m(e){let{otherUserData:t,messages:n,sendMessage:s,currentUserData:a}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u,{otherUserData:t}),(0,r.jsx)(d,{messages:n,currentUserId:null==a?void 0:a.id}),(0,r.jsx)(f,{sendMessage:s})]})}function h(){return(0,r.jsx)("div",{className:"w-full h-full flex justify-center items-center",children:"No Conversation Selected"})}var p=function(e){let{messages:t,sendMessage:n,currentUserData:s,otherUserData:a}=e;return(0,r.jsx)("div",{className:"w-3/4 h-full overflow-auto bg-white ml-0 flex flex-col items-center rounded-lg",children:a?(0,r.jsx)(m,{messages:t,sendMessage:n,currentUserData:s,otherUserData:a}):(0,r.jsx)(h,{})})},x=n(84298),g=n(95650),v=n(98179);function y(e){let{chat:t,onClick:n,isSelected:s}=e,a=t.lastMessageData,l="",c="";if(a&&null!=a.lastMessage){l=(0,g.aF)(a.lastMessage.content,50);let e=a.lastMessageTime;c=(0,g.Sg)(e)}return(0,r.jsx)("div",{className:"h-14 bg-opacity-20 mb-[18px] items-center px-[10px] py-[6px] rounded-lg cursor-pointer ".concat(s?"bg-primary-300":"bg-white"),onClick:()=>n(t),children:(0,r.jsxs)("div",{className:"flex h-full justify-between items-center",children:[(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[(0,r.jsx)(i,{user:t,isOnline:t.isOnline,alt:"profile pic"}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("p",{className:"text-[16px]",children:t.name}),(0,r.jsx)("p",{className:"text-[13px] text-my-gray-200",children:l})]})]}),(0,r.jsx)("p",{className:"flex flex-col text-[15px] justify-center text-my-gray-200",children:c})]})},t._id)}function j(e){let{Roles:t,selectedRole:n,handleRoleSelect:s}=e;return(0,r.jsx)("div",{className:"w-full h-fit mb-[18px] rounded-lg overflow-x-scroll no-scrollbar",children:(0,r.jsx)("div",{className:"flex justify-center items-center min-w-max",children:t.map(e=>{let t=n===e;return(0,r.jsx)("p",{className:"flex flex-col h-full ".concat(t?"bg-primary-300 border-2 border-primary-300 text-white":"text-secondary-300 border-2 border-secondary-200"," text-[15px] px-2 py-2 font-medium mr-2 rounded-full whitespace-nowrap cursor-pointer"),onClick:()=>s(e),children:e},e)})})})}var w=function(e){let{onChatClick:t,userData:n,selectedRole:a,handleRoleSelect:c,handleSearchClick:o,setUserData:i,currentUserData:u,total:d}=e,[f,m]=(0,s.useState)(""),[h,p]=(0,s.useState)(null),[g,w]=(0,s.useState)(1),[S,b]=(0,s.useState)(10);async function N(){let e={currentUserId:null==u?void 0:u.id,searchBarInput:f,selectedRole:a,page:g+1,limit:10};console.log("loading more..."),i((await (0,x.sm)(e)).data),w(g+1)}return(0,r.jsxs)("div",{className:"w-4/12 h-full bg-white  flex flex-col items-center px-[10px] py-2 rounded-lg ",children:[(0,r.jsxs)("div",{className:"relative w-full h-12 mb-[18px]",children:[(0,r.jsx)(l.dVI,{className:"cursor-pointer absolute right-4 top-1/2 transform -translate-y-1/2 text-secondary-300",size:20,onClick:()=>o(f)}),(0,r.jsx)("input",{className:"w-full h-12 px-4 py-3 border border-secondary-200 rounded-lg focus:outline-none text-[16px] font-medium text-secondary-300",placeholder:"Search Here",value:f,onChange:e=>m(e.target.value)})]}),(0,r.jsx)(j,{Roles:["Admin","Booth Karyakarta","Survey Collector","Support Executive","Survey Manager"],selectedRole:a,handleRoleSelect:c}),(0,r.jsx)("div",{className:"w-full h-full flex-1 flex-col overflow-y-scroll rounded-lg",id:"scrollableDiv",children:(0,r.jsx)(v.Z,{dataLength:null==n?void 0:n.length,next:N,hasMore:(null==n?void 0:n.length)<d,loader:(0,r.jsx)("h4",{children:"Loading..."}),scrollableTarget:"scrollableDiv",endMessage:(0,r.jsx)("p",{style:{textAlign:"center"},children:"No more chats"}),children:null==n?void 0:n.map(e=>(0,r.jsx)(y,{chat:e,onClick:e=>{p(e._id),t(e)},isSelected:h===e._id},e._id))})})]})},S=n(34999),b=n(1633),N=()=>{let e=(0,g.a_)(),{id:t}=e||{},[n,r]=(0,s.useState)(null),[a,l]=(0,s.useState)([]),[c,o]=(0,s.useState)(""),[i,u]=(0,s.useState)(e),[d,f]=(0,s.useState)([]),[m,h]=(0,s.useState)(""),[p,v]=(0,s.useState)(""),[y,j]=(0,s.useState)(0);async function w(){let e={currentUserId:null==i?void 0:i.id,searchBarInput:p,selectedRole:m},t=await (0,x.sm)(e);f(t.data),j(t.total)}(0,s.useEffect)(()=>{let e=(0,S.ZP)(b.M6,{query:{id:t}});return r(e),w(),()=>{e.disconnect()}},[]);let N=e=>{let{roomId:t,messages:n}=e;l(n),o(t)},_=e=>{let{roomId:t,newMessage:n}=e;if(console.log("message recieved curr roomid",c),console.log("message recieved",n),c!==t){w();return}l([...a,n])},M=e=>{u(e=>({...e,isOnline:!0}))},k=e=>{u(e=>({...e,isOnline:!1}))};return(0,s.useEffect)(()=>{if(n)return n.on("room_joined",N),n.on("new_message",_),n.on("user_online",M),n.on("user_offline",k),()=>{n.off("user_online",M),n.off("user_offline",k),n.off("room_joined",N),n.off("new_message",_)}},[n,N,_,M,k]),(0,s.useEffect)(()=>{w()},[a,m,p,i]),{messages:a,userData:d,currentUserData:i,selectedRole:m,totalUsers:y,handleRoleSelect:e=>{m===e?h(""):h(e)},handleSearchClick:e=>{v(e)},sendMessage:e=>{n&&t&&n.emit("send_message",{roomId:c,senderId:t,content:e})},joinRoom:(e,t)=>{n&&n.emit("join_room",{currentUserId:e,otherUserId:t})},setUserData:f}},_=function(){let[e,t]=(0,s.useState)(null),{messages:n,currentUserData:a,userData:l,selectedRole:c,totalUsers:o,handleRoleSelect:i,handleSearchClick:u,sendMessage:d,joinRoom:f,setUserData:m}=N();return(0,r.jsxs)("main",{className:"w-full flex gap-8 p-6 bg-[#ECF0FA] h-[calc(100vh-80px)] overflow-hidden",children:[(0,r.jsx)(w,{onChatClick:e=>{f(a.id,e._id),t(e)},userData:l,selectedRole:c,currentUserData:a,total:o,handleRoleSelect:i,handleSearchClick:u,setUserData:e=>{m(t=>[...t,e])}}),(0,r.jsx)(p,{messages:n,sendMessage:d,currentUserData:a,otherUserData:e})]})}},76965:function(e,t,n){"use strict";var r=n(57437);n(2265);var s=n(96164);t.Z=function(e){let{children:t,className:n,onClick:a}=e;return(0,r.jsx)("button",{onClick:a,className:(0,s.m6)("border text-white bg-primary-300 px-4 py-2 rounded-md",n),children:t})}},84298:function(e,t,n){"use strict";n.d(t,{AW:function(){return l},PR:function(){return a},Sh:function(){return c},TJ:function(){return o},sm:function(){return i}});var r=n(1633),s=n(38472);let a=async e=>{try{let t=localStorage.getItem("token"),n={method:"GET",url:"".concat(r.M6,"/").concat(r.Tp,"?userId=").concat(e),headers:{Authorization:"Bearer ".concat(t)}};return(await s.Z.request(n)).data.data}catch(e){return{success:!1,message:"Something Went Wrong",error:e}}},l=async e=>{try{var t;let n=localStorage.getItem("token"),a={method:"GET",url:"".concat(r.M6,"/").concat(r.SR),params:{filter:e.searchBarInput||"",getWithProfilePicture:null!==(t=e.withProfilePic)&&void 0!==t&&t,role:e.selectedRole||"",page:e.page,limit:e.limit},headers:{Authorization:"Bearer ".concat(n)}};return(await s.Z.request(a)).data}catch(e){return{success:!1,message:"Something Went Wrong",error:e}}},c=async e=>{try{let t={method:"POST",url:"".concat(r.M6,"/").concat(r.Tv),data:e};console.log(t);let n=await s.Z.request(t);return console.log(n),n.data.success}catch(e){return{success:!1,message:"Something Went Wrong",error:e}}},o=async e=>{try{let t={method:"POST",url:"".concat(r.M6,"/").concat(r.rd),data:e},n=await s.Z.request(t);return console.log(n),n.data}catch(e){return{success:!1,message:"Something Went Wrong",error:e}}},i=async e=>{try{let t={method:"GET",url:"".concat(r.M6,"/").concat(r.tm),params:{filter:e.searchBarInput,role:e.selectedRole,currentUserId:e.currentUserId,page:e.page,limit:e.limit}};return(await s.Z.request(t)).data}catch(e){return{success:!1,message:"Something Went Wrong while getting all chats data",error:e}}}},95650:function(e,t,n){"use strict";n.d(t,{Sg:function(){return l},aF:function(){return a},a_:function(){return c},p6:function(){return s}});let r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function s(e){let t=new Date(e),n=String(t.getDate()).padStart(2,"0"),s=r[t.getMonth()],a=t.getFullYear();return"".concat(n,"-").concat(s,"-").concat(a)}function a(e,t){return e.length>t?e.slice(0,t)+"...":e}function l(e){let t=new Date(e),n=String(t.getDate()).padStart(2,"0"),s=r[t.getMonth()];return"".concat(n," ").concat(s)}function c(){{let e=localStorage.getItem("jwt_token");return e?JSON.parse(atob(e.split(".")[1])):null}}},1633:function(e,t,n){"use strict";n.d(t,{A5:function(){return d},Dy:function(){return u},HA:function(){return p},M6:function(){return r},SR:function(){return a},TK:function(){return i},Tp:function(){return s},Tv:function(){return l},dt:function(){return f},it:function(){return m},jC:function(){return x},jV:function(){return y},q6:function(){return j},rO:function(){return g},rd:function(){return c},tm:function(){return o},vx:function(){return h},x4:function(){return v}});let r="https://survey-3uf0.onrender.com",s="api/user/getUser",a="api/user/getAllUsers",l="api/user/addUsers",c="api/user/addMultipleUsers",o="api/chatroom/getAllChatsData",i="api/survey/saveSurvey",u="api/survey/updateSurvey",d="api/survey/getSurvey",f="api/survey/deleteSurvey",m="api/survey/getAllSurveys",h="api/response/saveResponses",p="api/response/getAllSurveyResponses",x="api/response/getAllResponses",g=["Contact Form","Address"],v="api/auth/login",y="api/auth/forgotPassword",j="api/auth/resetPassword"}},function(e){e.O(0,[1779,614,8472,6164,4049,8611,2971,7023,1744],function(){return e(e.s=4522)}),_N_E=e.O()}]);