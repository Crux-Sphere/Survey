(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7688],{61540:function(e,s,t){Promise.resolve().then(t.bind(t,50058))},50058:function(e,s,t){"use strict";t.r(s);var l=t(57437),a=t(76965),n=t(81382),c=t(40855),o=t(2265),i=t(60152),r=t(16463),d=t(84298),u=t(88726),p=t(80106),x=t(77744),h=t(77902),m=t(60274),f=t(78731),v=t(55691),g=t(95673),j=t(50336),b=t(82744),S=t(64785),y=t(66648),N=t(554),w=t(69824),Z=t(1633),_=t(17042),C=t(56806);function P(){let[e,s]=(0,o.useState)(null),[t,P]=(0,o.useState)(null),[A,D]=(0,o.useState)([]),[k,M]=(0,o.useState)(!1),[R,E]=(0,o.useState)(!1),[O,F]=(0,o.useState)(""),[B,I]=(0,o.useState)([]),[q,L]=(0,o.useState)(""),[U,J]=(0,o.useState)(""),[K,Q]=(0,o.useState)(""),[W,z]=(0,o.useState)(""),[G,T]=(0,o.useState)(""),[V,Y]=(0,o.useState)([]),[H,X]=(0,o.useState)([]),[$,ee]=(0,o.useState)(!0),[es,et]=(0,o.useState)(!1),[el,ea]=(0,o.useState)(null),[en,ec]=(0,o.useState)(null),[eo,ei]=(0,o.useState)(!1),[er,ed]=(0,o.useState)(null),[eu,ep]=(0,o.useState)(!1),[ex,eh]=(0,o.useState)(!1),[em,ef]=(0,o.useState)(null),[ev,eg]=(0,o.useState)(null),[ej,eb]=(0,o.useState)(null),[eS,ey]=(0,o.useState)(null),[eN,ew]=(0,o.useState)(1),[eZ,e_]=(0,o.useState)(10),[eC,eP]=(0,o.useState)(1),[eA,eD]=(0,o.useState)(!1),[ek,eM]=(0,o.useState)([]),[eR,eE]=(0,o.useState)(!1),[eO,eF]=(0,o.useState)(!1),[eB,eI]=(0,o.useState)(null),[eq,eL]=(0,o.useState)(null),eU=(0,r.useSearchParams)();(0,_.Z)();let eJ=eU.get("survey_id"),eK=(0,r.useRouter)(),{isLoaded:eQ}=(0,x.Ji)({id:"google-map-script",googleMapsApiKey:"AIzaSyAAOwDBvpg5ZDv5JFG-CoDW23GsKkOPeuA"});async function eW(){let s,l;e&&t&&(s=new Date(e||""),l=new Date(t||""),s.setDate(s.getDate()+1),l.setDate(l.getDate()+1));let a={surveyId:eJ,startDate:s,endDate:l,userId:q,filters:V,limit:eZ,page:eC};et(!0);let n=await (0,i.K7)(a);X(n.data),ew(n.totalPages),console.log("responses of responses ------>",n),n.data&&n.data.length>0&&ed(n.data[0].responses.map(e=>({question:e.question,question_id:e.question_id}))),et(!1)}async function ez(){let e=await (0,m.LA)({_id:eJ});console.log("current survey-->",e),e.success?(console.log("setting ac_list",e.data.ac_list),eE(e.data.imported),eM(e.data.ac_list),ey(e.data.questions.map(e=>e))):u.ZP.error("Error fetching the survey!")}async function eG(){et(!0);let e=await (0,d.AW)({selectedRole:Z.py});console.log("users-------->",e.data),D(e.data),et(!1)}async function eT(){et(!0),console.log("ac list is coming  --->",ek);let e=await (0,d.Yx)({ac_list:ek,filter:em});console.log("panna below-------->",e),eg(e),et(!1)}(0,o.useEffect)(()=>{ez(),eW(),eG()},[$,eC,eZ,q,V]),(0,o.useEffect)(()=>{ek.length>0&&eT()},[em,ek]);let eV=()=>{M(!1),eY()},eY=()=>{J(""),Q(""),z("")},eH=async()=>{try{let s,l;eD(!0),e&&t&&(s=new Date(e||""),l=new Date(t||""),s.setDate(s.getDate()+1),l.setDate(l.getDate()+1));let a={surveyId:eJ,startDate:s,endDate:l,userId:q,filters:V,download:!0},n="response.xlsx",c=await (0,i.kz)(a),o=c.headers["content-disposition"];console.log("header ======>",o);let r=o.split("filename=")[1].replace(/"/g,"");r&&(n=r);let d=window.URL.createObjectURL(new Blob([c.data])),u=document.createElement("a");u.href=d,u.setAttribute("download",n),document.body.appendChild(u),u.click(),document.body.removeChild(u)}catch(e){u.ZP.error("Failed to export to Excel")}finally{eD(!1)}},eX=null==A?void 0:A.map(e=>({value:e._id,label:e.name}));return(0,l.jsxs)("div",{className:"flex flex-col w-full font-medium bg-light-gray",children:[(0,l.jsxs)("nav",{className:"w-full py-3 px-8 flex flex-col gap-10 font-semibold",children:[(0,l.jsx)("h3",{className:"text-[24px] font-semibold",children:"Survey Response"}),(0,l.jsxs)("div",{className:"flex w-full gap-12",children:[(0,l.jsx)(f.Z,{appliedFilters:V,filters:B,responses:H,selectedFilter:G,setAppliedFilters:Y,setSelectedFilter:T,surveyQuestions:eS}),(0,l.jsxs)("div",{className:"flex space-x-2 text-black text-base font-semibold",children:[(0,l.jsx)(a.Z,{loading:eA,onClick:eH,className:"rounded-[20px] h-fit px-4 py-2 w-44 justify-center",children:"Export to Excel"}),(0,l.jsx)(n.Z,{onClick:()=>eK.back(),className:"rounded-[20px] h-fit px-4 py-2",children:"Back"})]})]})]}),(0,l.jsx)("div",{className:"p-5 font-semibold text-sm ",children:(0,l.jsx)("div",{className:"bg-light-gray space-y-4 w-full rounded-lg px-4 py-6",children:(0,l.jsxs)("div",{className:"w-[780px] space-y-8 pb-6 ",children:[(0,l.jsxs)("div",{className:"flex gap-10",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex gap-3 items-center mb-5",children:[(0,l.jsx)("h1",{className:"",children:"Date Range"}),(0,l.jsx)(y.default,{src:N.Z.src,alt:"calender",height:18,width:18})]}),(0,l.jsx)("div",{className:"w-fit",children:(0,l.jsx)(c.Z,{className:"w-[352px] h-10",startDate:e,endDate:t,setStartDate:s,setEndDate:P})})]}),(0,l.jsx)(a.Z,{className:" flex justify-center items-center h-fit self-end",onClick:()=>{M(!0)},children:"Advanced data filter +"})]}),(0,l.jsxs)("div",{className:"flex gap-5 items-center",children:[(0,l.jsx)("div",{className:"flex flex-col space-y-2 w-[352px]",children:(0,l.jsx)(h.ZP,{value:eX.find(e=>e.value===q),onChange:e=>L((null==e?void 0:e.value)||""),options:eX,placeholder:"Select user",classNamePrefix:"react-select",isSearchable:!0})}),(0,l.jsxs)("div",{className:"flex space-x-4",children:[(0,l.jsx)(n.Z,{onClick:()=>{s(null),P(null),L(""),Y([]),ee(!$)},className:"bg-dark-gray text-white",children:"Reset"}),(0,l.jsx)(a.Z,{disabled:0===V.length&&!q.trim()&&!e&&!t,onClick:()=>{if(e&&!t||t&&!e){u.ZP.error("Please select a complete date range!");return}eW()},className:"disabled:cursor-not-allowed disabled:bg-primary-100 disabled:text-secondary-100",children:"Apply"})]})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[ek&&ek.length>0&&(0,l.jsx)(a.Z,{onClick:()=>eh(!0),children:"Assign Data"}),(0,l.jsx)(a.Z,{onClick:()=>eF(!0),children:"Assign Booth"})]})]})})}),es&&(0,l.jsx)(p.Z,{className:"h-[30vh] w-full flex justify-center items-center"}),!es&&H&&H.length>0?(0,l.jsx)(S.Z,{selectedPanna:ej,more:el,responses:H,setMapModalIsOpen:ei,setMore:ea,setResponseModalIsOpen:E,setSelectedResponse:ec,users:A,assignMode:eu,setAssignedMode:ep,getUserResponses:eW,setSelectedPanna:eb}):!es&&(0,l.jsx)("div",{className:"flex w-full justify-center items-center h-[30vh]",children:(0,l.jsx)("p",{children:"No responses found"})}),!es&&(0,l.jsxs)("div",{className:"flex gap-3 items-center mt-4 pl-4 py-3 sticky bottom-0 left-0 bg-[#ECF0FA]",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"limit-select",className:"mr-2",children:"Show:"}),(0,l.jsxs)("select",{id:"limit-select",value:eZ,onChange:e=>{e_(parseInt(e.target.value,10))},className:"p-2 border rounded-md",children:[(0,l.jsx)("option",{value:10,children:"10"}),(0,l.jsx)("option",{value:20,children:"20"}),(0,l.jsx)("option",{value:50,children:"50"}),(0,l.jsx)("option",{value:100,children:"100"})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("button",{onClick:()=>{eP(eC-1)},disabled:1===eC,className:"p-2 border rounded-md disabled:opacity-50",children:(0,l.jsx)(w.u1R,{})}),(0,l.jsxs)("span",{children:["Page ",eC," of ",eN]}),(0,l.jsx)("button",{onClick:()=>{eP(eC+1)},disabled:eC===eN,className:"p-2 border rounded-md disabled:opacity-50",children:(0,l.jsx)(w.hjJ,{})})]})]}),(0,l.jsx)(v.Z,{modalIsOpen:k,closeModal:eV,surveyQuestions:eS,question:U,questionType:O,operator:K,response:W,setQuestionType:F,setQuestion:J,setOperator:Q,setResponse:z,saveFilter:()=>{I([...B,{question:U,operator:K,response:W}]),eV()}}),(0,l.jsx)(g.Z,{responseModalIsOpen:R,selectedResponse:en,setResponseModalIsOpen:E,users:A}),(0,l.jsx)(b.Z,{isLoaded:eQ,mapModalIsOpen:eo,setMapModalIsOpen:ei}),(0,l.jsx)(j.Z,{assignMode:eu,pannaPramukh:ev,selectedPanna:ej,setAssignMode:ep,setSelectedPanna:eb,setUserModal:eh,setUserSearch:ef,userModal:ex,userSearch:em||""}),(0,l.jsx)(C.Z,{survey_id:eJ||"",acList:ek,boothModal:eO,setBoothModal:eF,isImported:eR})]})}s.default=()=>(0,l.jsx)(o.Suspense,{children:(0,l.jsx)(P,{})})},56806:function(e,s,t){"use strict";var l=t(57437),a=t(2265),n=t(85260),c=t(77902),o=t(76965),i=t(88726),r=t(84298),d=t(1633);s.Z=function(e){let{boothModal:s,setBoothModal:t,acList:u,survey_id:p,isImported:x}=e,h=[{value:d.py,label:"Survey Collector"},{value:d.ZL,label:"District President"},{value:d.af,label:"Shakti Kendra"},{value:d.il,label:"Booth Adhyaksh"},{value:d.aA,label:"Voter Relationship executive"}],[m,f]=(0,a.useState)(h),[v,g]=(0,a.useState)(null),[j,b]=(0,a.useState)([]),[S,y]=(0,a.useState)(""),[N,w]=(0,a.useState)([]),[Z,_]=(0,a.useState)(!1),C=async e=>{try{let s;_(!0),s=v===d.ZL||v===d.af||v===d.il?await (0,r.WC)({role:v}):await (0,r.AW)({selectedRole:e}),console.log("users ---->",s),s.success?b(s.data||[]):i.ZP.error("Failed to fetch users")}catch(e){i.ZP.error("An error occurred while fetching users")}_(!1)};(0,a.useEffect)(()=>{f(x?h:h.filter(e=>"Survey Collector"!==e.label))},[x]),(0,a.useEffect)(()=>{v?(console.log(" ------->",v),C(v)):b([])},[v]);let P=null==j?void 0:j.map(e=>({value:e._id,label:e.name})),A=null==u?void 0:u.map(e=>({value:e.ac_no,label:"AC ".concat(e.ac_no)})),D=(e,s)=>{w(t=>t.map(t=>t.ac_no===e?{...t,booth_numbers:s.map(e=>e.value)}:t))},k=e=>{w(s=>s.filter(s=>s.ac_no!==e))},M=async()=>{if(_(!0),!S||0===N.length){i.ZP.error("Please select all fields"),_(!1);return}let e=N.map(e=>({...e,survey_id:p})),s={survey_id:p,userId:S,ac_list:e};"671f997d38863c2bfc859e76"===v&&(s.editResponses=!0);try{(await (0,r.J2)(s)).success?(i.ZP.success("AC and Booth assigned successfully!"),t(!1)):i.ZP.error("Failed to assign AC and Booth")}catch(e){i.ZP.error("An error occurred during assignment")}finally{_(!1)}};return(0,l.jsx)(n.Z,{open:s,closeModal:()=>t(!1),children:(0,l.jsxs)("div",{className:"min-h-[50vh] max-h-[90vh] flex items-center gap-5 p-8 flex-col bg-secondary-100 overflow-y-auto",children:[(0,l.jsx)("h1",{className:"text-xl font-bold text-primary-300",children:"Assign AC and Booth to User"}),(0,l.jsx)("div",{className:"flex flex-col space-y-2 w-[352px]",children:(0,l.jsx)(c.ZP,{value:m.find(e=>e.value===v),onChange:e=>g((null==e?void 0:e.value)||null),options:m,placeholder:"Select Role",classNamePrefix:"react-select",isSearchable:!0})}),(0,l.jsx)("div",{className:"flex flex-col space-y-2 w-[352px]",children:(0,l.jsx)(c.ZP,{value:P.find(e=>e.value===S),onChange:e=>y((null==e?void 0:e.value)||""),options:P,placeholder:"Select User",classNamePrefix:"react-select",isSearchable:!0,isDisabled:!v})}),(0,l.jsx)("div",{className:"flex flex-col space-y-2 w-[352px]",children:(0,l.jsx)(c.ZP,{onChange:e=>{let s=e.value;N.some(e=>e.ac_no===s)||w([...N,{ac_no:s,booth_numbers:[]}])},options:A,placeholder:"Select AC",classNamePrefix:"react-select",isSearchable:!0})}),N.map(e=>{var s;let t=null===(s=u.find(s=>s.ac_no===e.ac_no))||void 0===s?void 0:s.booth_numbers.map(e=>({value:e,label:"Booth ".concat(e)}));return(0,l.jsxs)("div",{className:"flex flex-col space-y-2 w-[352px]",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("h2",{className:"text-lg font-semibold text-primary-300",children:["AC ",e.ac_no]}),(0,l.jsx)("button",{onClick:()=>k(e.ac_no),className:"text-red-500 underline text-sm",children:"Remove"})]}),(0,l.jsx)(c.ZP,{value:e.booth_numbers.map(e=>null==t?void 0:t.find(s=>s.value===e)),onChange:s=>D(e.ac_no,s||[]),options:t,placeholder:"Select Booths for AC ".concat(e.ac_no),classNamePrefix:"react-select",isSearchable:!0,isMulti:!0})]},e.ac_no)}),(0,l.jsx)(o.Z,{disabled:Z,loading:Z,className:"mt-auto disabled:bg-primary-100",onClick:M,children:"Assign"})]})})}},17042:function(e,s,t){"use strict";t.d(s,{Z:function(){return n}});var l=t(95650),a=t(2265);function n(){let[e,s]=(0,a.useState)(null);return(0,a.useEffect)(()=>{let e=(0,l.a_)();e&&s(e)},[]),e}}},function(e){e.O(0,[5223,5452,7699,4574,1544,7240,1910,8472,8726,9413,1181,8143,4049,1071,9693,2274,1805,8780,8155,198,2971,7023,1744],function(){return e(e.s=61540)}),_N_E=e.O()}]);